!function(t,e){if("function"==typeof define&&define.amd)define(["exports"],e);else if("undefined"!=typeof exports)e(exports);else{var r={exports:{}};e(r.exports),t.prouter=r.exports}}(this,function(t){"use strict";var e="object"==typeof self&&self.self===self&&self||"object"==typeof global&&global.global===global&&global,r=function(){function t(t,e){this.path=t,this.query=e,this._full=this.path,void 0!==this.query&&null!==this.query&&""!==this.query&&(this._full+="?"+this.query)}return Object.defineProperty(t.prototype,"full",{get:function(){return this._full},enumerable:!0,configurable:!0}),t}();t.Resource=r;var n=new RegExp(["(\\\\.)","([\\/.])?(?:(?:\\:(\\w+)(?:\\(((?:\\\\.|[^()])+)\\))?|\\(((?:\\\\.|[^()])+)\\))([+*?])?|(\\*))"].join("|"),"g"),a=/^[#\/]|\s+$/g,s=/#.*$/,i=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},o=function(){function t(){}return t._escapeString=function(t){return t.replace(/([.+*?=^!:${}()[\]|\/])/g,"\\$1")},t._escapeGroup=function(t){return t.replace(/([=!:$\/()])/g,"\\$1")},t._flags=function(t){return t.sensitive?"":"i"},t.parseQuery=function(t){for(var e={},r=t.split("&"),n=0;n<r.length;n++){var a=r[n].split("=");e[decodeURIComponent(a[0])]=decodeURIComponent(a[1])}return e},t.parseFragment=function(e){if(""===e)return new r(e);var n,s,i=e.indexOf("?");return e=t.decodeFragment(e).replace(a,""),i>=0?(n=e.slice(0,i),s=e.slice(i+1)):n=e,new r(n,s)},t.decodeFragment=function(t){return t=t.replace(/%25/g,"%2525"),e.decodeURI(t)},t._parse=function(e){for(var r,a=[],s=0,i=0,o="";r=n.exec(e);){var h=r[0],l=r[1],u=r.index;if(o+=e.slice(i,u),i=u+h.length,l)o+=l[1];else{o&&(a.push(o),o="");var c=r[2],p=r[3],f=r[4],_=r[5],d=r[6],g=r[7],v="+"===d||"*"===d,y="?"===d||"*"===d,m=c||"/",b=f||_||(g?".*":"[^"+m+"]+?");a.push({name:p||s++,prefix:c||"",delimiter:m,optional:y,repeat:v,pattern:t._escapeGroup(b)})}}return i<e.length&&(o+=e.substr(i)),o&&a.push(o),a},t._tokensToRegExp=function(e,r){void 0===r&&(r={});for(var n=r.strict,a=r.end!==!1,s="",i=e[e.length-1],o="string"==typeof i&&i.length&&"/"===i.charAt(i.length-1),h=0;h<e.length;h++){var l=e[h];if("string"==typeof l)s+=t._escapeString(l);else{var u=t._escapeString(l.prefix),c=l.pattern;l.repeat&&(c+="(?:"+u+c+")*"),c=l.optional?u?"(?:"+u+"("+c+"))?":"("+c+")?":u+"("+c+")",s+=c}}return n||(s=(o?s.slice(0,-2):s)+"(?:\\/(?=$))?"),s+=a?"$":n&&o?"":"(?=\\/|$)",new RegExp("^"+s,t._flags(r))},t.stringToRegexp=function(e,r,n){void 0===r&&(r=[]);for(var a=t._parse(e),s=t._tokensToRegExp(a,n),i=0;i<a.length;i++)"string"!=typeof a[i]&&r.push(a[i]);return s.keys=r,s},t}(),h=function(){function t(){this._location=e.location,this._history=e.history,this._handlers=[],this._eventHandlers={},this._checkUrl=this._checkUrl.bind(this)}return t.prototype.on=function(t,e){return void 0===this._eventHandlers[t]&&(this._eventHandlers[t]=[]),this._eventHandlers[t].push(e),this},t.prototype.off=function(t,e){if(this._eventHandlers[t])for(var r=this._eventHandlers[t],n=0;n<r.length;n++)if(r[n]===e){r.splice(n,1),0===r.length&&delete this._eventHandlers[t];break}return this},t.prototype.trigger=function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];var n=this._eventHandlers[t];if(void 0===n||!n.length)return null;for(var a=0;a<n.length;a++){var s=n[a].apply(this,e);if(s===!1)return!1}return!0},t.prototype.isAtRoot=function(){var t=this._location.pathname.replace(/[^\/]$/,"$&/");return t===this._root&&!this._location.search},t.prototype.getCurrentPath=function(){var t=o.decodeFragment(this._location.pathname).slice(this._root.length-1);"/"===t.charAt(0)&&(t=t.slice(1));var n=e.decodeURIComponent(this._location.search.slice(1)),a=t;return n&&(a+="?"+n),new r(t,n)},t.prototype.getCurrentHash=function(){var t=this._location.href.match(/#(.*)$/),e=t?t[1]:"";return o.parseFragment(e)},t.prototype.obtainFragment=function(t){return void 0===t||null===t?this._usePushState||!this._wantsHashChange?this.getCurrentPath():this.getCurrentHash():o.parseFragment(t)},t.prototype.start=function(r){if(void 0===r&&(r={}),t._started)throw new Error("Router.history has already been started");if(t._started=!0,this._root=r.root||"/",this._wantsHashChange=r.hashChange!==!1,this._wantsPushState=!!r.pushState,this._hasPushState=!(!this._history||!this._history.pushState),this._usePushState=this._wantsPushState&&this._hasPushState,this._fragment=this.obtainFragment(),this._root=("/"+this._root+"/").replace(/^\/{2,}|\/{2,}$/g,"/"),this._wantsHashChange&&this._wantsPushState){var n=this.isAtRoot();if(!this._hasPushState&&!n){var a=this._root.slice(0,-1)||"/";return this._location.replace(a+"#"+this.getCurrentPath().full),!0}this._hasPushState&&n&&this.navigate(this.getCurrentHash().full,null,{replace:!0,trigger:!1})}return this._usePushState?e.addEventListener("popstate",this._checkUrl,!1):this._wantsHashChange&&e.addEventListener("hashchange",this._checkUrl,!1),r.silent?!1:this._loadUrl()},t.prototype.stop=function(){e.removeEventListener("popstate",this._checkUrl,!1),e.removeEventListener("hashchange",this._checkUrl,!1),t._started=!1},t.prototype._add=function(t,e){this._handlers.push({route:t,callback:e})},t.prototype.navigate=function(e,r,n){if(void 0===n&&(n={}),!t._started)return!1;var a=this.obtainFragment(e);this._fragment=a;var i=this._root;""===a.path&&(i=i.slice(0,-1)||"/");var o=a.full,h=i+o;if(o=o.replace(s,""),this._usePushState)this._history[n.replace?"replaceState":"pushState"](null,null,h);else{if(!this._wantsHashChange)return this._location.assign(h);this._updateHash(o,n.replace)}return n.trigger!==!1?this._loadUrl(o,r):!1},t.prototype._checkUrl=function(){return this._loadUrl()},t.prototype._loadUrl=function(t,e){this._fragment=this.obtainFragment(t);for(var r=this._handlers.length,n=0;r>n;n++){var a=this._handlers[n];if(a.route.test(this._fragment.path))return a.callback(this._fragment,e),!0}return!1},t.prototype._updateHash=function(t,e){if(e){var r=this._location.href.replace(/(javascript:|#).*$/,"");this._location.replace(r+"#"+t)}else this._location.hash="#"+t},t._started=!1,t}();t.History=h;var l=function(){function t(t){void 0===t&&(t={}),this._bindHandlers(i(t)?t:t.map)}return t.prototype._bindHandlers=function(t){if(t)for(var e=0;e<t.length;e++)this.add(t[e])},t.prototype.add=function(e){var r=this,n=o.stringToRegexp(e.route);return t.history._add(n,function(a,s){var i=t._extractParameters(n,a.path),o={path:a.path,query:a.query,params:i,message:s,handler:e},h=t.history.trigger("route:before",r,o,r._oldRouteData);h!==!1&&(r._oldRouteData&&r._oldRouteData.handler.deactivate&&(h=r._oldRouteData.handler.deactivate.call(r._oldRouteData.handler,o,r._oldRouteData),h===!1)||(e.activate.call(e,o,r._oldRouteData),t.history.trigger("route:after",r,o,r._oldRouteData),r._oldRouteData=o))}),this},t._extractParameters=function(t,r){var n={},a=t.exec(r);if(!a)return n;for(var s=a.slice(1),i=t.keys,o=0;o<s.length;o++)n[i[o].name]=e.decodeURIComponent(s[o]);return n},t}();t.Router=l,l.history=new h});