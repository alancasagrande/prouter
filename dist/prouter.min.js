!function(e,t){"function"==typeof define&&define.amd?define(t):"object"==typeof exports?module.exports=t(require,exports,module):e.prouter=t()}(this,function(e,t,r){var n;return function(e){var t="object"==typeof self&&self.self===self&&self||"object"==typeof global&&global.global===global&&global,r={mode:"hash",keys:!0,root:"/",rerouting:!0},n=/\((.*?)\)/g,o=/(\(\?)?:\w+/g,a=/\*\w+/g,i=/[\-{}\[\]+?.,\\\^$|#\s]/g,s=function(){function e(){}return e._extractKeys=function(e){var t=e.match(/:([^\/]+)/g);if(t){for(var r=[],n=0;n<t.length;n++)r[n]=t[n].replace(/[:\(\)]/g,"");return r}return null},e._routeToRegExp=function(e){return e=e.replace(i,"\\$&").replace(n,"(?:$1)?").replace(o,function(e,t){return t?e:"([^/?]+)"}).replace(a,"([^?]*)"),new RegExp("^"+e+"(?:\\?*([^/]*))")},e._clearSlashes=function(e){return e.replace(/\/$/,"").replace(/^\//,"")},e._extractParameters=function(e,r){var n=e.exec(r).slice(1),o=[];if(n){for(var a=n.length-1,i=0;a>i;i++)o.push(n[i]||null);o.push(n[a]?t.decodeURIComponent(n[a]):null)}return o},e._parseQuery=function(e){for(var r={},n=e.split("&"),o=0;o<n.length;o++){var a=n[o].split("="),i=t.decodeURIComponent(a[0]);r[i]=t.decodeURIComponent(a[1])}return r},e._prepareArguments=function(t,r){var n=t.length-1,o=t[n];if(r&&r.length){for(var a={},i=0;i<r.length;i++)a[r[i]]=t[i];t[r.length]&&(a.query=e._parseQuery(t[r.length])),t=[a]}else o&&o.indexOf("=")>=0&&(t[n]=e._parseQuery(o));return t},e}(),l=function(){function e(e){void 0===e&&(e={}),this._options=e,this._routes=[],this.config(this._options)}return e.prototype.config=function(e){for(var t in r)void 0!==e[t]?this._options[t]=e[t]:void 0===this._options[t]&&(this._options[t]=r[t]);return this},e.prototype.add=function(e,t){var r,n;return"function"==typeof e?(t=e,n=/.*/):(r=s._extractKeys(e),n=s._routeToRegExp(e)),this._routes.push({path:n,callback:t,keys:r,alias:e}),this},e.prototype.remove=function(e){for(var t=this._routes.length-1;t>=0;t--){var r=this._routes[t];(e===r.alias||e===r.callback||e===r.path)&&this._routes.splice(t,1)}return this},e.prototype.check=function(e,t,r){for(var n=0;n<this._routes.length;n++){var o=this._routes[n],a=e.match(o.path);if(a){var i=s._extractParameters(o.path,e),l=this._options.keys?o.keys:null;i=s._prepareArguments(i,l);var u=e.slice(0,a[0].length)!==r.slice(0,a[0].length),c={alias:o.alias,callback:o.callback,params:i,routes:[],rootRerouting:this._options.rerouting||u};t.push(c),o.facade&&(e=e.slice(a[0].length,e.length),r=r.slice(a[0].length,r.length),o.facade.check(e,c.routes,r));break}}return t},e.prototype.drop=function(){return this._routes=[],this.config(r),this},e.prototype.to=function(t){for(var r,n=0;n<this._routes.length;n++){var o=this._routes[n];if(t===o.alias){r=o.facade,r||(r=new e(this._options),o.facade=r);break}}return r},e}();e.RoutingLevel=l;var u=function(){function e(){}return e.drop=function(){return e._lastURL="",e.off(),e._firstLevel.drop()},e._listen=function(){if(e._listening)throw new Error("Prouter already listening");t.addEventListener("hashchange",function(){var t=e.getCurrent();e.check(t)},!1),t.addEventListener("popstate",function(t){if(null!==t.state&&void 0!==t.state){var r=e.getCurrent();e.check(r)}},!1),e._listening=!0},e.check=function(t){var r=e._firstLevel.check(t,[],e._lastURL);return e._apply(r),e._firstLevel},e.navigate=function(r){var n=e._firstLevel._options.mode;switch(n){case"history":t.history.pushState(null,null,e._firstLevel._options.root+s._clearSlashes(r));break;case"hash":t.location.href=t.location.href.replace(/#(.*)$/,"")+"#"+r;break;case"node":e._lastURL=r}return e._firstLevel},e.route=function(t){var r=e.getCurrent(),n=e.trigger("route:before",t,r);return n===!1?!1:("node"===e._firstLevel._options.mode&&e.check(t),e.navigate(t),e.trigger("route:after",t,r),!0)},e.config=function(t){return e._firstLevel.config(t)},e.to=function(t){return e._firstLevel.to(t)},e.add=function(t,r){return e._firstLevel.add(t,r)},e.remove=function(t){return e._firstLevel.remove(t)},e.getCurrent=function(){var r=e._firstLevel._options.mode,n=e._firstLevel._options.root,o=e._lastURL;if("history"===r)o=s._clearSlashes(t.decodeURI(t.location.pathname+t.location.search)),o=o.replace(/\?(.*)$/,""),o="/"!==n?o.replace(n,""):o,o=s._clearSlashes(o);else if("hash"===r){var a=t.location.href.match(/#(.*)$/);o=a?a[1]:"",o=s._clearSlashes(o)}return o},e.on=function(t,r){return void 0===e._eventHandlers[t]&&(e._eventHandlers[t]=[]),e._eventHandlers[t].push(r),e},e.off=function(t,r){if(void 0===t)e._eventHandlers={};else if(e._eventHandlers[t])if(r){for(var n=e._eventHandlers[t],o=0;o<n.length;o++)n[o]===r&&n.splice(o,1);0===n.length&&delete e._eventHandlers[t]}else delete e._eventHandlers[t];return e},e.trigger=function(t){for(var r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];var o=e._eventHandlers[t];if(!o||!o.length)return null;for(var a=0;a<o.length;a++){var i=o[a].apply(null,r);if(i===!1)return!1}return!0},e._applyNested=function(t){return function(r){"string"==typeof r?e.route(r):t&&t.length&&e._apply(t)}},e._apply=function(t){for(var r,n=0;n<t.length;n++){var o=t[n];o.rootRerouting&&(r=o.callback.apply(null,o.params)),e._applyNested(o.routes)(r)}},e._firstLevel=new l,e._eventHandlers={},e._lastURL="",e._listening=!1,e}();e.Router=u,u._listen()}(n||(n={})),n});