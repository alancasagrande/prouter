!function(t,e){if("function"==typeof define&&define.amd)define(["exports"],e);else if("undefined"!=typeof exports)e(exports);else{var r={exports:{}};e(r.exports),t.prouter=r.exports}}(this,function(t){"use strict";var e="undefined"!=typeof window?window:global,r=e.document,a=/\((.*?)\)/g,s=/(\(\?)?:\w+/g,i=/\*\w+/g,n=/[\-{}\[\]+?.,\\\^$|#\s]/g,o=/^[#\/]|\s+$/g,h=/^\/+|\/+$/g,l=/#.*$/,c=function(){function t(){this._location=e.location,this._history=e.history,this._handlers=[],this._evtHandlers={},this._checkUrl=this._checkUrl.bind(this)}return t.prototype.atRoot=function(){var t=this._location.pathname.replace(/[^\/]$/,"$&/");return t===this._root&&!this.getSearch()},t._decodeFragment=function(t){return decodeURI(t.replace(/%25/g,"%2525"))},t.prototype.getSearch=function(){var t=this._location.href.replace(/#.*/,"").match(/\?.+/);return t?t[0]:""},t.prototype.getHash=function(){var t=this._location.href.match(/#(.*)$/);return t?t[1]:""},t.prototype.getPath=function(){var e=t._decodeFragment(this._location.pathname+this.getSearch()).slice(this._root.length-1);return"/"===e.charAt(0)?e.slice(1):e},t.prototype.getFragment=function(t){return(void 0===t||null===t)&&(t=this._usePushState||!this._wantsHashChange?this.getPath():this.getHash()),t.replace(o,"")},t.prototype.start=function(e){if(void 0===e&&(e={}),t._started)throw new Error("Router.history has already been started");if(t._started=!0,this._root=e.root||"/",this._wantsHashChange=e.hashChange!==!1,this._wantsPushState=!!e.pushState,this._hasPushState=!(!this._history||!this._history.pushState),this._usePushState=this._wantsPushState&&this._hasPushState,this._fragment=this.getFragment(),this._root=("/"+this._root+"/").replace(h,"/"),this._wantsHashChange&&this._wantsPushState){var r=this.atRoot();if(!this._hasPushState&&!r){var a=this._root.slice(0,-1)||"/";return this._location.replace(a+"#"+this.getPath()),!0}this._hasPushState&&r&&this.navigate(this.getHash(),null,{replace:!0,trigger:!1})}return this._usePushState?addEventListener("popstate",this._checkUrl,!1):this._wantsHashChange&&addEventListener("hashchange",this._checkUrl,!1),e.silent?!1:this._loadUrl()},t.prototype.stop=function(){e.removeEventListener("popstate",this._checkUrl,!1),e.removeEventListener("hashchange",this._checkUrl,!1),t._started=!1},t.prototype.addHandler=function(t,e){this._handlers.unshift({route:t,callback:e})},t.prototype._checkUrl=function(){var t=this.getFragment();return t===this._fragment?!1:this._loadUrl()},t.prototype._loadUrl=function(t,e){this._fragment=this.getFragment(t);for(var r=this._handlers.length,a=0;r>a;a++){var s=this._handlers[a];if(s.route.test(this._fragment))return s.callback(this._fragment,e),!0}return!1},t.prototype.navigate=function(e,a,s){if(void 0===s&&(s={}),!t._started)return!1;e=this.getFragment(e);var i=this._root;(""===e||"?"===e.charAt(0))&&(i=i.slice(0,-1)||"/");var n=i+e;if(e=t._decodeFragment(e.replace(l,"")),this._fragment===e)return!1;if(this._fragment=e,this._usePushState)this._history[s.replace?"replaceState":"pushState"]({},r.title,n);else{if(!this._wantsHashChange)return this._location.assign(n);this._updateHash(e,s.replace)}return s.trigger!==!1?this._loadUrl(e,a):!1},t.prototype.on=function(t,e){return void 0===this._evtHandlers[t]&&(this._evtHandlers[t]=[]),this._evtHandlers[t].push(e),this},t.prototype.off=function(t,e){if(this._evtHandlers[t])for(var r=this._evtHandlers[t],a=r.length,s=0;a>s;s++)if(r[s]===e){r.splice(s,1),0===r.length&&delete this._evtHandlers[t];break}return this},t.prototype.trigger=function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];var a=this._evtHandlers[t];if(void 0!==a)for(var s=a.length,i=0;s>i;i++)a[i].apply(this,e)},t.prototype._updateHash=function(t,e){if(e){var r=this._location.href.replace(/(javascript:|#).*$/,"");this._location.replace(r+"#"+t)}else this._location.hash="#"+t},t._started=!1,t}();t.History=c;var p=function(){function t(t){void 0===t&&(t={}),this._evtHandlers={},this.trigger=c.prototype.trigger,this.on=c.prototype.on,this.off=c.prototype.off,this._bindHandlers(t.map)}return t.prototype.addHandler=function(e){var r=this,a=t._routeToRegExp(e.route);return t.history.addHandler(a,function(s,i){var n=t._extractParameters(a,s),o=n.slice(0),h={"new":{fragment:s,params:o,message:i}};r._old&&(h.old={fragment:r._old.fragment,params:r._old.params}),r.trigger("route:before",h),t.history.trigger("route:before",r,h),h.canceled||(n.push(h),r._old&&r._old.handler.deactivate&&r._old.handler.deactivate.apply(r._old.handler),e.activate.apply(e,n),r.trigger("route:after",h),t.history.trigger("route:after",r,h),r._old={fragment:s,params:o,handler:e})}),this},t.prototype.navigate=function(e,r,a){return t.history.navigate(e,r,a),this},t.prototype._bindHandlers=function(t){if(t)for(var e=t.length-1,r=e;r>=0;r--)this.addHandler(t[r])},t._routeToRegExp=function(t){var e=t.replace(n,"\\$&").replace(a,"(?:$1)?").replace(s,function(t,e){return e?t:"([^/?]+)"}).replace(i,"([^?]*?)");return new RegExp("^"+e+"(?:\\?([\\s\\S]*))?$")},t._extractParameters=function(t,e){var r=t.exec(e).slice(1);return r.map(function(t,e){return e===r.length-1?t:void 0===t?void 0:decodeURIComponent(t)})},t}();t.Router=p,p.history=new c});