!function(e,t){"function"==typeof define&&define.amd?define(t):"object"==typeof exports?module.exports=t(require,exports,module):e.Router=t()}(this,function(e,t,r){var o="object"==typeof self&&self.self===self&&self||"object"==typeof global&&global.global===global&&global,n={mode:"node",keys:!0,root:"/",rerouting:!0},a=JSON.stringify(n),i=/\((.*?)\)/g,s=/(\(\?)?:\w+/g,c=/\*\w+/g,u=/[\-{}\[\]+?.,\\\^$|#\s]/g,l=/.*/,h=function(){function e(){}return e._getRouteKeys=function(e){var t=e.match(/:([^\/]+)/g);if(t){for(var r=new Array(t.length),o=0;o<t.length;o++)r[o]=t[o].replace(/[:\(\)]/g,"");return r}return null},e._routeToRegExp=function(e){return e=e.replace(u,"\\$&").replace(i,"(?:$1)?").replace(s,function(e,t){return t?e:"([^/?]+)"}).replace(c,"([^?]*)"),new RegExp("^"+e+"(?:\\?*([^/]*))")},e._clearSlashes=function(e){return e.replace(/\/$/,"").replace(/^\//,"")},e._extractParameters=function(e,t){var r=e.exec(t).slice(1);return r.map(function(e,t){return t===r.length-1?e||null:e?o.decodeURIComponent(e):null})},e._parseQuery=function(e){for(var t={},r=e.split("&"),n=0;n<r.length;n++){var a=r[n].split("="),i=o.decodeURIComponent(a[0]);t[i]=o.decodeURIComponent(a[1])}return t},e._prepareArguments=function(t,r){var o=t.length-1,n=t[o];if(r){for(var a={},i=0;i<r.length;i++)a[r[i]]=t[i];t[r.length]&&(a.query=e._parseQuery(t[r.length])),t=[a]}else n&&n.indexOf("=")>-1&&(t[o]=e._parseQuery(n));return t},e}(),f=function(){function e(){this._routes=[],this._options=JSON.parse(a)}return e.prototype.add=function(e,t){var r,o;return"function"==typeof e?(t=e,o=l):(r=h._getRouteKeys(e),o=h._routeToRegExp(e)),this._routes.push({path:o,callback:t,keys:r,alias:e,facade:null}),this},e.prototype.remove=function(e){for(var t=this._routes.length-1;t>=0;t--){var r=this._routes[t];(e===r.alias||e===r.callback||e===r.path)&&this._routes.splice(t,1)}return this},e.prototype.check=function(e,t,r){for(var o=0;o<this._routes.length;o++){var n=this._routes[o],a=e.match(n.path);if(a){var i=h._extractParameters(n.path,e),s=this._options.keys?n.keys:null;i=h._prepareArguments(i,s);var c=e.slice(0,a[0].length)!==r.slice(0,a[0].length),u={callback:n.callback,params:i,routes:[],rootRerouting:this._options.rerouting||c};t.push(u),n.facade&&(e=e.slice(a[0].length,e.length),r=r.slice(a[0].length,r.length),n.facade.check(e,u.routes,r));break}}return t},e.prototype.drop=function(){return this._routes=[],this.config(n),this},e.prototype.config=function(e){return e&&(this._options.keys=e.keys,this._options.mode=e.mode?e.mode:this._options.mode,this._options.root=e.root?"/"+h._clearSlashes(e.root)+"/":this._options.root,this._options.rerouting=e.rerouting),this},e.prototype.to=function(t){for(var r,o=0;o<this._routes.length;o++){var n=this._routes[o];if(t===n.alias){r=n.facade,r||(r=new e,r.config(this._options),n.facade=r);break}}return r},e}(),p=function(e){function t(e){return function(t){t===!1?(a=!0,i.navigate(n)):"string"==typeof t?i.route(t):e&&e.length&&r(e)}}function r(e){if(e)for(var r,o=0;o<e.length;o+=1){var n=e[o];n.rootRerouting&&(r=n.callback.apply(null,n.params)),t(n.routes)(r)}}var n="",a=!1,i={drop:function(){return n="",e.drop()},listen:function(){var e=this;o.addEventListener("hashchange",function(){var t=e.getCurrent();e.check(t)},!1),o.addEventListener("popstate",function(t){if(null!==t.state&&void 0!==t.state){var r=e.getCurrent();e.check(r)}},!1)},check:function(t){return r(e.check(t,[],n)),e},navigate:function(t){var r=e._options.mode;switch(r){case"history":o.history.pushState(null,null,e._options.root+h._clearSlashes(t));break;case"hash":o.location.href=o.location.href.replace(/#(.*)$/,"")+"#"+t;break;case"node":n=t}return e},route:function(t){return"node"===e._options.mode&&this.check(t),a||this.navigate(t),a=!1,e},config:function(t){return e.config(t)},to:function(t){return e.to(t)},add:function(t,r){return e.add(t,r)},remove:function(t){return e.remove(t)},getCurrent:function(){var t=e._options.mode,r=e._options.root,a=n;if("history"===t)a=h._clearSlashes(o.decodeURI(o.location.pathname+o.location.search)),a=a.replace(/\?(.*)$/,""),a="/"!==r?a.replace(r,""):a,a=h._clearSlashes(a);else if("hash"===t){var i=o.location.href.match(/#(.*)$/);a=i?i[1]:"",a=h._clearSlashes(a)}return a}};return i}(new f);return p});