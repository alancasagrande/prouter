!function(e,t){"function"==typeof define&&define.amd?define(t):"object"==typeof exports?module.exports=t(require,exports,module):e.prouter=t()}(this,function(e,t,r){var n;return function(e){var t="object"==typeof self&&self.self===self&&self||"object"==typeof global&&global.global===global&&global,r={mode:"hash",keys:!0,root:"/",rerouting:!0},n=/\((.*?)\)/g,i=/(\(\?)?:\w+/g,o=/\*\w+/g,s=/[\-{}\[\]+?.,\\\^$|#\s]/g,a=function(){function e(){}return e._extractKeys=function(e){var t=e.match(/:([^\/]+)/g);if(t){for(var r=[],n=0;n<t.length;n++)r[n]=t[n].replace(/[:\(\)]/g,"");return r}return null},e._routeToRegExp=function(e){return e=e.replace(s,"\\$&").replace(n,"(?:$1)?").replace(i,function(e,t){return t?e:"([^/?]+)"}).replace(o,"([^?]*)"),new RegExp("^"+e+"(?:\\?*([^/]*))")},e._clearSlashes=function(e){return e.replace(/\/$/,"").replace(/^\//,"")},e._extractParameters=function(e,r){var n=e.exec(r).slice(1),i=[];if(n){for(var o=n.length-1,s=0;o>s;s++)i.push(n[s]||null);i.push(n[o]?t.decodeURIComponent(n[o]):null)}return i},e._parseQuery=function(e){for(var r={},n=e.split("&"),i=0;i<n.length;i++){var o=n[i].split("="),s=t.decodeURIComponent(o[0]);r[s]=t.decodeURIComponent(o[1])}return r},e._prepareArguments=function(t,r){var n=t.length-1,i=t[n];if(r&&r.length){for(var o={},s=0;s<r.length;s++)o[r[s]]=t[s];t[r.length]&&(o.query=e._parseQuery(t[r.length])),t=[o]}else i&&i.indexOf("=")>=0&&(t[n]=e._parseQuery(i));return t},e}(),l=function(){function e(e){void 0===e&&(e={}),this._options=e,this._routes=[],this.config(this._options)}return e.prototype.config=function(e){for(var t in r)void 0!==e[t]?this._options[t]=e[t]:void 0===this._options[t]&&(this._options[t]=r[t]);return this},e.prototype.add=function(e,t){var r,n;return"function"==typeof e?(t=e,n=/.*/):(r=a._extractKeys(e),n=a._routeToRegExp(e)),this._routes.push({path:n,callback:t,keys:r,alias:e}),this},e.prototype.remove=function(e){for(var t=this._routes.length-1;t>=0;t--){var r=this._routes[t];(e===r.alias||e===r.callback||e===r.path)&&this._routes.splice(t,1)}return this},e.prototype.check=function(e,t,r){for(var n=0;n<this._routes.length;n++){var i=this._routes[n],o=e.match(i.path);if(o){var s=a._extractParameters(i.path,e),l=this._options.keys?i.keys:null;s=a._prepareArguments(s,l);var u=e.slice(0,o[0].length)!==r.slice(0,o[0].length),h={alias:i.alias,callback:i.callback,params:s,routes:[],rootRerouting:this._options.rerouting||u};t.push(h),i.facade&&(e=e.slice(o[0].length,e.length),r=r.slice(o[0].length,r.length),i.facade.check(e,h.routes,r));break}}return t},e.prototype.drop=function(){return this._routes=[],this.config(r),this},e.prototype.to=function(t){for(var r,n=0;n<this._routes.length;n++){var i=this._routes[n];if(t===i.alias){r=i.facade,r||(r=new e(this._options),i.facade=r);break}}return r},e}();e.RoutingLevel=l;var u=function(){function e(){}return e.drop=function(){return this._lastURL="",this.off(),this._firstLevel.drop()},e._listen=function(){var e=this;if(this._listening)throw new Error("Prouter already listening");t.addEventListener("hashchange",function(){var t=e.getCurrent();e.check(t)},!1),t.addEventListener("popstate",function(t){if(null!==t.state&&void 0!==t.state){var r=e.getCurrent();e.check(r)}},!1),this._listening=!0},e.check=function(e){var t=this._firstLevel.check(e,[],this._lastURL);return this._apply(t),this._firstLevel},e.navigate=function(e){var r=this._firstLevel._options.mode;switch(r){case"history":t.history.pushState(null,null,this._firstLevel._options.root+a._clearSlashes(e));break;case"hash":t.location.href=t.location.href.replace(/#(.*)$/,"")+"#"+e;break;case"node":this._lastURL=e}return this._firstLevel},e.route=function(e){var t=this.getCurrent(),r=this.trigger("route:before",e,t);return r===!1?!1:("node"===this._firstLevel._options.mode&&this.check(e),this.navigate(e),this.trigger("route:after",e,t),!0)},e.config=function(e){return this._firstLevel.config(e)},e.to=function(e){return this._firstLevel.to(e)},e.add=function(e,t){return this._firstLevel.add(e,t)},e.remove=function(e){return this._firstLevel.remove(e)},e.getCurrent=function(){var e=this._firstLevel._options.mode,r=this._firstLevel._options.root,n=this._lastURL;if("history"===e)n=a._clearSlashes(t.decodeURI(t.location.pathname+t.location.search)),n=n.replace(/\?(.*)$/,""),n="/"!==r?n.replace(r,""):n,n=a._clearSlashes(n);else if("hash"===e){var i=t.location.href.match(/#(.*)$/);n=i?i[1]:"",n=a._clearSlashes(n)}return n},e.on=function(e,t){return void 0===this._eventHandlers[e]&&(this._eventHandlers[e]=[]),this._eventHandlers[e].push(t),this},e.off=function(e,t){if(void 0===e)this._eventHandlers={};else if(this._eventHandlers[e])if(t){for(var r=this._eventHandlers[e],n=0;n<r.length;n++)r[n]===t&&r.splice(n,1);0===r.length&&delete this._eventHandlers[e]}else delete this._eventHandlers[e];return this},e.trigger=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];var n=this._eventHandlers[e];if(!n||!n.length)return null;for(var i=0;i<n.length;i++){var o=n[i].apply(null,t);if(o===!1)return!1}return!0},e._applyNested=function(t){return function(r){"string"==typeof r?e.route(r):t&&t.length&&e._apply(t)}},e._apply=function(e){for(var t,r=0;r<e.length;r++){var n=e[r];n.rootRerouting&&(t=n.callback.apply(null,n.params)),this._applyNested(n.routes)(t)}},e._firstLevel=new l,e._eventHandlers={},e._lastURL="",e._listening=!1,e}();e.Router=u,u._listen()}(n||(n={})),n});