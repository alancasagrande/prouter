!function(e,t){"function"==typeof define&&define.amd?define(t):"object"==typeof exports?module.exports=t(require,exports,module):e.Router=t()}(this,function(e,t,o){var r="object"==typeof self&&self.self===self&&self||"object"==typeof global&&global.global===global&&global,n=["node","hash","history"],i={mode:"node",keys:!0,root:"/",rerouting:!0},a=/\((.*?)\)/g,s=/(\(\?)?:\w+/g,u=/\*\w+/g,c=/[\-{}\[\]+?.,\\\^$|#\s]/g,l=/.*/,h=function(){function e(){}return e._getRouteKeys=function(e){var t=e.match(/:([^\/]+)/g);if(!t)return t;for(var o=0;o<t.length;o++)t[o]=t[o].replace(/[:\(\)]/g,"");return t},e._routeToRegExp=function(e){return e=e.replace(c,"\\$&").replace(a,"(?:$1)?").replace(s,function(e,t){return t?e:"([^/?]+)"}).replace(u,"([^?]*)"),new RegExp("^"+e+"(?:\\?*([^/]*))")},e._clearSlashes=function(e){return e.replace(/\/$/,"").replace(/^\//,"")},e._extractParameters=function(e,t){var o=e.exec(t).slice(1);return o.map(function(e,t){return t===o.length-1?e||null:e?r.decodeURIComponent(e):null})},e._parseQuery=function(e){for(var t={},o=e.split("&"),n=0;n<o.length;n++){var i=o[n].split("=");t[r.decodeURIComponent(i[0])]=r.decodeURIComponent(i[1])}return t},e._prepareArguments=function(t,o){var r={},n=t.length-1,i=t[n];if(o&&o.length>0){for(var a=0;a<o.length;a++)r[o[a]]=t[a];t[o.length]&&(r.query=e._parseQuery(t[o.length])),t=[r]}else i&&i.indexOf("=")>-1&&(t[n]=e._parseQuery(i));return t},e}(),f=function(){function e(){this._routes=[],this._options=JSON.parse(JSON.stringify(i))}return e.prototype.add=function(e,t){var o,r;return"function"==typeof e?(t=e,r=l):(o=h._getRouteKeys(e),r=h._routeToRegExp(e)),this._routes.push({path:r,callback:t,keys:o,alias:e,facade:null}),this},e.prototype.remove=function(e){for(var t=this._routes.length-1;t>=0;t--){var o=this._routes[t];if(e===o.alias||e===o.callback||e===o.path)this._routes.splice(t,1);else if(o._routes)for(var r=o._routes.length-1;r>=0;r--)o._routes[r].remove(e)}return this},e.prototype.check=function(e,t,o){for(var r=0;r<this._routes.length;r++){var n=this._routes[r],i=e.match(n.path);if(i){var a=h._extractParameters(n.path,e),s=this._options.keys?n.keys:null;a=h._prepareArguments(a,s);var u=e.slice(0,i[0].length)!==o.slice(0,i[0].length),c={callback:n.callback,params:a,routes:[],rootRerouting:this._options.rerouting||u};t.push(c),n.facade&&(e=e.slice(i[0].length,e.length),o=o.slice(i[0].length,o.length),n.facade.check(e,c.routes,o));break}}return t},e.prototype.drop=function(){return this._routes=[],this.config(i),this},e.prototype.config=function(e){return e&&(this._options.keys="boolean"==typeof e.keys?e.keys:this._options.keys,this._options.mode=-1!==n.indexOf(e.mode)?e.mode:this._options.mode,this._options.root=e.root?"/"+h._clearSlashes(e.root)+"/":this._options.root,this._options.rerouting="boolean"==typeof e.rerouting?e.rerouting:this._options.rerouting),this},e.prototype.to=function(t){for(var o,r=0;r<this._routes.length;r++){var n=this._routes[r];if(t===n.alias){o=n.facade,o||(o=new e,o.config(this._options),n.facade=o);break}}return o},e}(),p=function(e){function t(e){return function(t){t===!1?(i=!0,a.navigate(n)):"string"==typeof t?a.route(t):e&&e.length&&o(e)}}function o(e){if(e)for(var o,r=0;r<e.length;r+=1){var n=e[r];n.rootRerouting&&(o=n.callback.apply(null,n.params)),t(n.routes)(o)}}var n="",i=!1,a={drop:function(){return n="",e.drop()},listen:function(){var e=this;r.addEventListener("hashchange",function(){var t=e.getCurrent();e.check(t)},!1),r.addEventListener("popstate",function(t){if(null!==t.state&&void 0!==t.state){var o=e.getCurrent();e.check(o)}},!1)},check:function(t){return o(e.check(t,[],n)),e},navigate:function(t){var o=e._options.mode;switch(o){case"history":r.history.pushState(null,null,e._options.root+h._clearSlashes(t));break;case"hash":r.location.href=r.location.href.replace(/#(.*)$/,"")+"#"+t;break;case"node":n=t}return e},route:function(t){return"node"===e._options.mode&&this.check(t),i||this.navigate(t),i=!1,e},config:function(t){return e.config(t)},to:function(t){return e.to(t)},add:function(t,o){return e.add(t,o)},remove:function(t){return e.remove(t)},getCurrent:function(){var t=e._options.mode,o=e._options.root,i=n;if("history"===t)i=h._clearSlashes(r.decodeURI(r.location.pathname+r.location.search)),i=i.replace(/\?(.*)$/,""),i="/"!==o?i.replace(o,""):i,i=h._clearSlashes(i);else if("hash"===t){var a=r.location.href.match(/#(.*)$/);i=a?a[1]:"",i=h._clearSlashes(i)}return i}};return a}(new f);return p});