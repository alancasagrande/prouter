!function(t,e){"function"==typeof define&&define.amd?define(e):"object"==typeof exports?module.exports=e(require,exports,module):t.Router=e()}(this,function(t,e,o){function n(t){for(var e=t.match(/:([^\/]+)/g),o=0,n=e?e.length:0;n>o;o++)e[o]=e[o].replace(/[:\(\)]/g,"");return e}function r(t){return t=t.replace(v,"\\$&").replace(p,"(?:$1)?").replace(g,function(t,e){return e?t:"([^/?]+)"}).replace(d,"([^?]*)"),new RegExp("^"+t+"(?:\\?*([^/]*))")}function i(t){return t.toString().replace(/\/$/,"").replace(/^\//,"")}function a(t,e){var o=t.exec(e).slice(1);return o.map(function(t,e){return e===o.length-1?t||null:t?decodeURIComponent(t):null})}function s(t){for(var e={},o=t.split("&"),n=0;n<o.length;n++){var r=o[n].split("=");e[decodeURIComponent(r[0])]=decodeURIComponent(r[1])}return e}function c(t,e){var o={},n=t.length-1,r=t[n];if(e&&e.length>0){for(var i=0;i<e.length;i++)o[e[i]]=t[i];t[e.length]&&(o.query=s(t[e.length])),t=[o]}else r&&r.indexOf("=")>-1&&(t[n]=s(r));return t}function l(){this._routes=[],this._options=JSON.parse(JSON.stringify(f))}var u="object"==typeof self&&self.self===self&&self||"object"==typeof global&&global.global===global&&global,h=["node","hash","history"],f={mode:"node",keys:!0,root:"/",rerouting:!0},p=/\((.*?)\)/g,g=/(\(\?)?:\w+/g,d=/\*\w+/g,v=/[\-{}\[\]+?.,\\\^$|#\s]/g,_=/.*/;l.prototype.add=function(t,e,o){var i,a;return"function"==typeof t?(o=e,e=t,a=_):(i=n(t),a=r(t)),this._routes.push({path:a,callback:e,keys:i,alias:o&&o.alias?o.alias:t,facade:null}),this},l.prototype.remove=function(t){for(var e=this._routes.length-1;e>-1;e-=1){var o=this._routes[e];if(t===o.alias||t===o.callback||t.toString()===o.path.toString())this._routes.splice(e,1);else if(o._routes.length>0)for(var n=o._routes.length-1;n>-1;n-=1)o._routes[n].remove(t)}return this},l.prototype.check=function(t,e,o){for(var n,r,i,s,l,u=0;u<this._routes.length,i=this._routes[u];u++)if(n=t.match(i.path)){s=a(i.path,t);var h=this._options.keys?i.keys:null;s=c(s,h),l=t.slice(0,n[0].length)!==o.slice(0,n[0].length),r={callback:i.callback,params:s,routes:[],rootRerouting:this._options.rerouting||l},e.push(r),i.facade&&(t=t.slice(n[0].length,t.length),o=o.slice(n[0].length,o.length),i.facade.check(t,r.routes,o));break}return e},l.prototype.drop=function(){return this._routes=[],this.config(f),this},l.prototype.config=function(t){return"object"==typeof t&&(this._options.keys="boolean"==typeof t.keys?t.keys:this._options.keys,this._options.mode=-1!==h.indexOf(t.mode)?t.mode:this._options.mode,this._options.root=t.root?"/"+i(t.root)+"/":this._options.root,this._options.rerouting="boolean"==typeof t.rerouting?t.rerouting:this._options.rerouting),this},l.prototype.to=function(t){for(var e,o,n=0;n<this._routes.length,o=this._routes[n];n+=1)t===o.alias&&(e=o.facade,e||(o.facade=e=(new l).config(this._options)));return e};var y=function(t){function e(t){return function(e){e===!1?(a=!0,n.navigate(r)):"string"==typeof e?n.route(e):t&&t.length&&o(t)}}function o(t){var o;if(t)for(var n=0,r=void 0;n<t.length,r=t[n];n+=1)r.rootRerouting&&(o=r.callback.apply(null,r.params)),e(r.routes)(o)}var n={},r="",a=!1;return n.drop=function(){return r="",t.drop()},n.listen=function(){var t=this,e=this.getCurrent();clearInterval(this._interval),this._interval=setInterval(function(){var o=n.getCurrent();e!==o&&(e=o,t.check(t.getCurrent()))},50),u.onpopstate=function(e){null!==e.state&&void 0!==e.state&&(u.clearInterval(t._interval),t.check(t.getCurrent()))}},n.check=function(e){return o(t.check(e,[],r)),t},n.navigate=function(e){var o=t._options.mode;switch(o){case"history":u.history.pushState(null,null,t._options.root+i(e));break;case"hash":u.location.href.match(/#(.*)$/),u.location.href=u.location.href.replace(/#(.*)$/,"")+"#"+e;break;case"node":r=e}return t},n.route=function(e){return"node"===t._options.mode&&this.check(e),a||this.navigate(e),a=!1,t},n.config=function(e){return t.config(e)},n.to=function(e){return t.to(e)},n.add=function(e,o,n){return t.add(e,o,n)},n.remove=function(e){return t.remove(e)},n.getCurrent=function(){var e=t._options.mode,o=t._options.root,n=r;if("history"===e)n=i(u.decodeURI(u.location.pathname+u.location.search)),n=n.replace(/\?(.*)$/,""),n="/"!==o?n.replace(o,""):n,n=i(n);else if("hash"===e){var a=u.location.href.match(/#(.*)$/);n=a?a[1]:"",n=i(n)}return n},n}(new l);return y});