!function(e,t){"function"==typeof define&&define.amd?define(t):"object"==typeof exports?module.exports=t(require,exports,module):e.prouter=t()}(this,function(e,t,r){var n;return function(e){var t="object"==typeof self&&self.self===self&&self||"object"==typeof global&&global.global===global&&global,r={mode:"hash",root:"/",rerouting:!0},n=new RegExp(["(\\\\.)","([\\/.])?(?:(?:\\:(\\w+)(?:\\(((?:\\\\.|[^()])+)\\))?|\\(((?:\\\\.|[^()])+)\\))([+*?])?|(\\*))"].join("|"),"g"),a=function(){function e(){}return e._escapeString=function(e){return e.replace(/([.+*?=^!:${}()[\]|\/])/g,"\\$1")},e._escapeGroup=function(e){return e.replace(/([=!:$\/()])/g,"\\$1")},e._clearSlashes=function(e){return e.replace(/\/$/,"").replace(/^\//,"")},e._flags=function(e){return e.sensitive?"":"i"},e._parse=function(t){for(var r,a=[],o=0,i=0,s="";r=n.exec(t);){var c=r[0],l=r[1],u=r.index;if(s+=t.slice(i,u),i=u+c.length,l)s+=l[1];else{s&&(a.push(s),s="");var f=r[2],p=r[3],h=r[4],g=r[5],d=r[6],v=r[7],_="+"===d||"*"===d,m="?"===d||"*"===d,y=f||"/",k=h||g||(v?".*":"[^"+y+"]+?");a.push({name:p||(o++).toString(),prefix:f||"",delimiter:y,optional:m,repeat:_,pattern:e._escapeGroup(k)})}}return i<t.length&&(s+=t.substr(i)),s&&a.push(s),a},e._tokensToPathExp=function(t,r){void 0===r&&(r={});for(var n=r.strict,a=r.end!==!1,o="",i=t[t.length-1],s="string"==typeof i&&i.length&&"/"===i.charAt(i.length-1),c=0;c<t.length;c++){var l=t[c];if("string"==typeof l)o+=e._escapeString(l);else{var u=e._escapeString(l.prefix),f=l.pattern;l.repeat&&(f+="(?:"+u+f+")*"),f=l.optional?u?"(?:"+u+"("+f+"))?":"("+f+")?":u+"("+f+")",o+=f}}return n||(o=(s?o.slice(0,-2):o)+"(?:\\/(?=$))?"),o+=a?"$":n&&s?"":"(?=\\/|$)",new RegExp("^"+o,e._flags(r))},e.parseSearchString=function(e){var t={};"?"===e.charAt(0)&&(e=e.slice(1));for(var r=e.split("&"),n=0;n<r.length;n++){var a=r[n].split("=");t[decodeURIComponent(a[0])]=decodeURIComponent(a[1])}return t},e.parsePath=function(r){r=e._clearSlashes(r);var n;return"function"==typeof t.URL?n=new t.URL(r,"http://example.com"):(n=document.createElement("a"),n.href="http://example.com/"+r),{path:n.pathname,query:e.parseSearchString(n.search),queryString:n.search}},e.extractRequest=function(r,n){var a=e.parsePath(r);a.params={};var o=n.exec(a.path);if(!o)return a;for(var i=o.slice(1),s=n.keys,c=0;c<i.length;c++)a.params[s[c].name]=t.decodeURIComponent(i[c]);return a},e.stringToPathExp=function(t,r){for(var n=e._parse(t),a=e._tokensToPathExp(n,r),o=[],i=0;i<n.length;i++)"string"!=typeof n[i]&&o.push(n[i]);return a.keys=o,a},e}(),o=function(){function e(e){void 0===e&&(e={}),this._routes=[],this._options={},this.config(e)}return e.prototype.config=function(e){for(var t in r)void 0!==e[t]?this._options[t]=e[t]:void 0===this._options[t]&&(this._options[t]=r[t]);return this},e.prototype.add=function(e,t){var r;return"function"==typeof e?(t=e,r=/.*/):r=a.stringToPathExp(e),this._routes.push({path:r,callback:t,alias:e}),this},e.prototype.remove=function(e){for(var t=this._routes.length-1;t>=0;t--){var r=this._routes[t];(e===r.alias||e===r.callback||e===r.path)&&this._routes.splice(t,1)}return this},e.prototype.check=function(e,t,r){for(var n=0;n<this._routes.length;n++){var o=this._routes[n],i=e.match(o.path);if(i){var s=a.extractRequest(e,o.path),c=e.slice(0,i[0].length)!==r.slice(0,i[0].length),l={alias:o.alias,callback:o.callback,params:s,routes:[],rootRerouting:this._options.rerouting||c};t.push(l),o.facade&&(e=e.slice(i[0].length,e.length),r=r.slice(i[0].length,r.length),o.facade.check(e,l.routes,r));break}}return t},e.prototype.drop=function(){return this._routes=[],this.config(r),this},e.prototype.to=function(t){for(var r,n=0;n<this._routes.length;n++){var a=this._routes[n];if(t===a.alias){r=a.facade,r||(r=new e(this._options),a.facade=r);break}}return r},e}();e.RoutingLevel=o;var i=function(){function e(){}return e.drop=function(){return e._lastURL="",e.off(),e.facade.drop()},e._listen=function(){if(e._listening)throw new Error("Prouter already listening");t.addEventListener("hashchange",function(){var t=e.getCurrent();e.check(t)},!1),t.addEventListener("popstate",function(t){if(null!==t.state&&void 0!==t.state){var r=e.getCurrent();e.check(r)}},!1),e._listening=!0},e.check=function(t){var r=e.facade.check(t,[],e._lastURL);return e._apply(r),e.facade},e.navigate=function(r){var n=e.facade._options.mode;switch(n){case"history":t.history.pushState(null,null,e.facade._options.root+a._clearSlashes(r));break;case"hash":t.location.href=t.location.href.replace(/#(.*)$/,"")+"#"+r;break;case"node":e._lastURL=r}return e.facade},e.route=function(t){var r=e.getCurrent(),n=e.trigger("route:before",t,r);return console.log("route current",r),n===!1?!1:(e.check(t),e.navigate(t),e.trigger("route:after",t,r),console.log("route path",t),!0)},e.config=function(t){return e.facade.config(t)},e.to=function(t){return e.facade.to(t)},e.add=function(t,r){return e.facade.add(t,r)},e.remove=function(t){return e.facade.remove(t)},e.getCurrent=function(){var r,n=e.facade._options.mode,o=e.facade._options.root;if("history"===n)r=a._clearSlashes(t.decodeURI(t.location.pathname+t.location.search)),r=r.replace(/\?(.*)$/,""),r="/"!==o?r.replace(o,""):r,r=a._clearSlashes(r);else if("hash"===n){var i=t.location.href.match(/#(.*)$/);r=i?i[1]:"",r=a._clearSlashes(r)}else r=e._lastURL;return r},e.on=function(t,r){return void 0===e._eventHandlers[t]&&(e._eventHandlers[t]=[]),e._eventHandlers[t].push(r),e},e.off=function(t,r){if(void 0===t)e._eventHandlers={};else if(e._eventHandlers[t])if(r){for(var n=e._eventHandlers[t],a=0;a<n.length;a++)n[a]===r&&n.splice(a,1);0===n.length&&delete e._eventHandlers[t]}else delete e._eventHandlers[t];return e},e.trigger=function(t){for(var r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];var a=e._eventHandlers[t];if(!a||!a.length)return null;for(var o=0;o<a.length;o++){var i=a[o].apply(null,r);if(i===!1)return!1}return!0},e._applyNested=function(t){return function(r){"string"==typeof r?e.route(r):t&&t.length&&e._apply(t)}},e._apply=function(t){for(var r,n=0;n<t.length;n++){var a=t[n];a.rootRerouting&&(r=a.callback.call(null,a.params)),e._applyNested(a.routes)(r)}},e.facade=new o,e._eventHandlers={},e._lastURL="",e._listening=!1,e}();e.Router=i,i._listen()}(n||(n={})),n});