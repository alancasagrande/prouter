!function(e,t){"function"==typeof define&&define.amd?define(t):"object"==typeof exports?module.exports=t(require,exports,module):e.Router=t()}(this,function(e,t,o){var r="object"==typeof self&&self.self===self&&self||"object"==typeof global&&global.global===global&&global,n=["node","hash","history"],i={mode:"node",keys:!0,root:"/",rerouting:!0},a=/\((.*?)\)/g,s=/(\(\?)?:\w+/g,u=/\*\w+/g,c=/[\-{}\[\]+?.,\\\^$|#\s]/g,l=/.*/,h=function(){function e(){}return e._getRouteKeys=function(e){for(var t=e.match(/:([^\/]+)/g),o=0,r=t?t.length:0;r>o;o++)t[o]=t[o].replace(/[:\(\)]/g,"");return t},e._routeToRegExp=function(e){return e=e.replace(c,"\\$&").replace(a,"(?:$1)?").replace(s,function(e,t){return t?e:"([^/?]+)"}).replace(u,"([^?]*)"),new RegExp("^"+e+"(?:\\?*([^/]*))")},e._clearSlashes=function(e){return e.replace(/\/$/,"").replace(/^\//,"")},e._extractParameters=function(e,t){var o=e.exec(t).slice(1);return o.map(function(e,t){return t===o.length-1?e||null:e?r.decodeURIComponent(e):null})},e._parseQuery=function(e){for(var t={},o=e.split("&"),n=0;n<o.length;n++){var i=o[n].split("=");t[r.decodeURIComponent(i[0])]=r.decodeURIComponent(i[1])}return t},e._prepareArguments=function(t,o){var r={},n=t.length-1,i=t[n];if(o&&o.length>0){for(var a=0;a<o.length;a++)r[o[a]]=t[a];t[o.length]&&(r.query=e._parseQuery(t[o.length])),t=[r]}else i&&i.indexOf("=")>-1&&(t[n]=e._parseQuery(i));return t},e}(),f=function(){function e(){this._routes=[],this._options=JSON.parse(JSON.stringify(i))}return e.prototype.add=function(e,t,o){var r,n;return"function"==typeof e?(o=t,t=e,n=l):(r=h._getRouteKeys(e),n=h._routeToRegExp(e)),this._routes.push({path:n,callback:t,keys:r,alias:o&&o.alias?o.alias:e,facade:null}),this},e.prototype.remove=function(e){for(var t=this._routes.length-1;t>-1;t--){var o=this._routes[t];if(e===o.alias||e===o.callback||e.toString()===o.path.toString())this._routes.splice(t,1);else if(o._routes.length>0)for(var r=o._routes.length-1;r>-1;r--)o._routes[r].remove(e)}return this},e.prototype.check=function(e,t,o){for(var r=0;r<this._routes.length;r++){var n=this._routes[r],i=e.match(n.path);if(i){var a=h._extractParameters(n.path,e),s=this._options.keys?n.keys:null;a=h._prepareArguments(a,s);var u=e.slice(0,i[0].length)!==o.slice(0,i[0].length),c={callback:n.callback,params:a,routes:[],rootRerouting:this._options.rerouting||u};t.push(c),n.facade&&(e=e.slice(i[0].length,e.length),o=o.slice(i[0].length,o.length),n.facade.check(e,c.routes,o));break}}return t},e.prototype.drop=function(){return this._routes=[],this.config(i),this},e.prototype.config=function(e){return e&&(this._options.keys="boolean"==typeof e.keys?e.keys:this._options.keys,this._options.mode=-1!==n.indexOf(e.mode)?e.mode:this._options.mode,this._options.root=e.root?"/"+h._clearSlashes(e.root)+"/":this._options.root,this._options.rerouting="boolean"==typeof e.rerouting?e.rerouting:this._options.rerouting),this},e.prototype.to=function(t){for(var o,r=0;r<this._routes.length;r++){var n=this._routes[r];t===n.alias&&(o=n.facade,o||(o=(new e).config(this._options),n.facade=o))}return o},e}(),p=function(e){function t(e){return function(t){t===!1?(a=!0,n.navigate(i)):"string"==typeof t?n.route(t):e&&e.length&&o(e)}}function o(e){if(e)for(var o,r=0;r<e.length;r+=1){var n=e[r];n.rootRerouting&&(o=n.callback.apply(null,n.params)),t(n.routes)(o)}}var n={},i="",a=!1;return n.drop=function(){return i="",e.drop()},n.listen=function(){var e=this,t=this.getCurrent();clearInterval(this._interval),this._interval=setInterval(function(){var o=n.getCurrent();t!==o&&(t=o,e.check(e.getCurrent()))},50),r.onpopstate=function(t){null!==t.state&&void 0!==t.state&&(r.clearInterval(e._interval),e.check(e.getCurrent()))}},n.check=function(t){return o(e.check(t,[],i)),e},n.navigate=function(t){var o=e._options.mode;switch(o){case"history":r.history.pushState(null,null,e._options.root+h._clearSlashes(t));break;case"hash":r.location.href=r.location.href.replace(/#(.*)$/,"")+"#"+t;break;case"node":i=t}return e},n.route=function(t){return"node"===e._options.mode&&this.check(t),a||this.navigate(t),a=!1,e},n.config=function(t){return e.config(t)},n.to=function(t){return e.to(t)},n.add=function(t,o,r){return e.add(t,o,r)},n.remove=function(t){return e.remove(t)},n.getCurrent=function(){var t=e._options.mode,o=e._options.root,n=i;if("history"===t)n=h._clearSlashes(r.decodeURI(r.location.pathname+r.location.search)),n=n.replace(/\?(.*)$/,""),n="/"!==o?n.replace(o,""):n,n=h._clearSlashes(n);else if("hash"===t){var a=r.location.href.match(/#(.*)$/);n=a?a[1]:"",n=h._clearSlashes(n)}return n},n}(new f);return p});