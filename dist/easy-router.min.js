!function(t,e){if("function"==typeof define&&define.amd)define(["exports"],e);else if("undefined"!=typeof exports)e(exports);else{var r={exports:{}};e(r.exports),t.easyRouter=r.exports}}(this,function(t){"use strict";var e="undefined"==typeof window?void 0:window,r=e.document,a=/\((.*?)\)/g,s=/(\(\?)?:\w+/g,i=/\*\w+/g,n=/[\-{}\[\]+?.,\\\^$|#\s]/g,o=/#(.*)$/,h=/[^\/]$/,l=/^[#\/]|\s+$/g,p=/^\/+|\/+$/g,c=/\/$/,_=/#.*$/,d=function(){function t(){this._location=e.location,this._history=e.history,this._handlers=[],this._evtHandlers={},this._checkUrl=this._checkUrl.bind(this)}return t.prototype.atRoot=function(){return this._location.pathname.replace(h,"$&/")===this._root},t.prototype.getHash=function(){var t=this._location.href.match(o);return t?t[1]:""},t.prototype.getFragment=function(t,r){var a=t;if(void 0===a||null===a)if(this._hasPushState||!this._wantsHashChange||r){a=e.decodeURI(this._location.pathname+this._location.search);var s=this._root.replace(c,"");0===a.lastIndexOf(s,0)&&(a=a.slice(s.length))}else a=this.getHash();else a=e.decodeURI(a);return a.replace(l,"")},t.prototype.start=function(a){if(void 0===a&&(a={}),t._started)throw new Error("Router.history has already been started");t._started=!0,this._root=a.root||"/",this._wantsHashChange=a.hashChange!==!1,this._wantsPushState=!!a.pushState,this._hasPushState=!!(a.pushState&&this._history&&this._history.pushState);var s=this.getFragment();if(this._root=("/"+this._root+"/").replace(p,"/"),this._hasPushState?e.addEventListener("popstate",this._checkUrl):this._wantsHashChange&&"onhashchange"in e&&e.addEventListener("hashchange",this._checkUrl),this._fragment=s,this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot())return this._fragment=this.getFragment(null,!0),this._location.replace(this._root+"#"+this._fragment),!0;this._hasPushState&&this.atRoot()&&this._location.hash&&(this._fragment=this.getHash().replace(l,""),this._history.replaceState({},r.title,this._root+this._fragment))}return a.silent!==!0?this._loadUrl():!1},t.prototype.stop=function(){e.removeEventListener("popstate",this._checkUrl),e.removeEventListener("hashchange",this._checkUrl),t._started=!1},t.prototype.addHandler=function(t,e){this._handlers.unshift({route:t,callback:e})},t.prototype._checkUrl=function(){var t=this.getFragment();return t===this._fragment?!1:void this._loadUrl()},t.prototype._loadUrl=function(t,e){this._fragment=this.getFragment(t);for(var r=this._handlers.length,a=0;r>a;a++){var s=this._handlers[a];if(s.route.test(this._fragment))return s.callback(this._fragment,e),!0}return!1},t.prototype.navigate=function(e,a,s){if(void 0===s&&(s={}),!t._started)return!1;var i=this.getFragment(e),n=this._root+i;if(i=i.replace(_,""),this._fragment===i)return!1;if(this._fragment=i,""===i&&"/"!==n&&(n=n.slice(0,-1)),this._hasPushState)this._history[s.replace?"replaceState":"pushState"]({},r.title,n);else{if(!this._wantsHashChange)return this._location.assign(n);this._updateHash(i,s.replace)}return s.trigger!==!1?this._loadUrl(i,a):!1},t.prototype.on=function(t,e){return void 0===this._evtHandlers[t]&&(this._evtHandlers[t]=[]),this._evtHandlers[t].push(e),this},t.prototype.off=function(t,e){if(this._evtHandlers[t])for(var r=this._evtHandlers[t],a=r.length,s=0;a>s;s++)if(r[s]===e){r.splice(s,1),0===r.length&&delete this._evtHandlers[t];break}return this},t.prototype.trigger=function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];var a=this._evtHandlers[t];if(void 0!==a)for(var s=a.length,i=0;s>i;i++)a[i].apply(this,e)},t.prototype._updateHash=function(t,e){if(e){var r=this._location.href.replace(/(javascript:|#).*$/,"");this._location.replace(r+"#"+t)}else this._location.hash="#"+t},t._started=!1,t}();t.History=d;var f=function(){function t(t){void 0===t&&(t={}),this._evtHandlers={},this.trigger=d.prototype.trigger,this.on=d.prototype.on,this.off=d.prototype.off,this._opts=t,this._bindHandlers()}return t.prototype.addHandler=function(e){var r=this,a=t._routeToRegExp(e.route);return t.history.addHandler(a,function(s,i){var n=t._extractParameters(a,s),o=n.slice(0),h={"new":{fragment:s,params:o,message:i}};r._old&&(h.old={fragment:r._old.fragment,params:r._old.params}),r.trigger("route:before",h),t.history.trigger("route:before",r,h),h.canceled||(n.push(h),r._old&&r._old.handler.deactivate&&r._old.handler.deactivate.apply(r._old.handler),e.activate.apply(e,n),r.trigger("route:after",h),t.history.trigger("route:after",r,h),r._old={fragment:s,params:o,handler:e})}),this},t.prototype.navigate=function(e,r,a){return t.history.navigate(e,r,a),this},t.prototype._bindHandlers=function(){if(this._opts.map)for(var t=this._opts.map,e=t.length-1,r=e;r>=0;r--)this.addHandler(t[r])},t._routeToRegExp=function(t){var e=t.replace(n,"\\$&").replace(a,"(?:$1)?").replace(s,function(t,e){return e?t:"([^/?]+)"}).replace(i,"([^?]*?)");return new RegExp("^"+e+"(?:\\?([\\s\\S]*))?$")},t._extractParameters=function(t,e){var r=t.exec(e).slice(1);return r.map(function(t,e){return e===r.length-1?t:void 0===t?void 0:decodeURIComponent(t)})},t}();t.Router=f,f.history=new d});