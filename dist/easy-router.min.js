(function(l,k){if("function"===typeof define&&define.amd)define(["exports"],k);else if("undefined"!==typeof exports)k(exports);else{var m={};k(m);l.easyRouter=m}})(this,function(l){var k=function(c,a){if(!(c instanceof a))throw new TypeError("Cannot call a class as a function");},m=function(){function c(a,e){for(var b=0;b<e.length;b++){var d=e[b];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(a,e,b){e&&c(a.prototype,e);
b&&c(a,b);return a}}();Object.defineProperty(l,"__esModule",{value:!0});var f="undefined"===typeof global?window:global,q=f.document,s=/\((.*?)\)/g,t=/(\(\?)?:\w+/g,u=/\*\w+/g,v=/[\-{}\[\]+?.,\\\^$|#\s]/g,w=/#(.*)$/,x=/[^\/]$/,r=/^[#\/]|\s+$/g,y=/^\/+|\/+$/g,z=/\/$/,A=/#.*$/,n=function(){function c(){k(this,c);this._started=!1;this._checkUrl=this._checkUrl.bind(this);this._handlers=[];this._evtHandlers={};this._location=f.location;this._history=f.history}m(c,[{key:"atRoot",value:function(){return this._location.pathname.replace(x,
"$&/")===this._root}},{key:"getHash",value:function(){var a=this._location.href.match(w);return a?a[1]:""}},{key:"getFragment",value:function(a,e){var b=a;if(void 0===b||null===b)if(this._hasPushState||!this._wantsHashChange||e){var b=f.decodeURI(this._location.pathname+this._location.search),d=this._root.replace(z,"");0===b.lastIndexOf(d,0)&&(b=b.slice(d.length))}else b=this.getHash();else b=f.decodeURI(b);return b.replace(r,"")}},{key:"start",value:function(a){a=void 0===a?{}:a;if(c._started)throw Error("Router.history has already been started");
c._started=!0;this._opts=a;this._opts.root=this._opts.root||"/";this._root=this._opts.root;this._wantsHashChange=!1!==this._opts.hashChange;this._wantsPushState=!!this._opts.pushState;this._hasPushState=!!(this._opts.pushState&&this._history&&this._history.pushState);a=this.getFragment();this._root=("/"+this._root+"/").replace(y,"/");this._hasPushState?f.addEventListener("popstate",this._checkUrl):this._wantsHashChange&&"onhashchange"in f&&f.addEventListener("hashchange",this._checkUrl);this._fragment=
a;if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot())return this._fragment=this.getFragment(null,!0),this._location.replace(this._root+"#"+this._fragment),!0;this._hasPushState&&this.atRoot()&&this._location.hash&&(this._fragment=this.getHash().replace(r,""),this._history.replaceState({},q.title,this._root+this._fragment))}if(!this._opts.silent)return this._loadUrl()}},{key:"stop",value:function(){f.removeEventListener("popstate",this._checkUrl);f.removeEventListener("hashchange",
this._checkUrl);c._started=!1}},{key:"navigateBack",value:function(){this._history.navigateBack()}},{key:"_addHandler",value:function(a,e){this._handlers.unshift({route:a,callback:e})}},{key:"_checkUrl",value:function(){if(this.getFragment()===this._fragment)return!1;this._loadUrl()}},{key:"_loadUrl",value:function(a,e){this._fragment=this.getFragment(a);for(var b=this._handlers.length,d=void 0,c=0;c<b;c++)if(d=this._handlers[c],d.route.test(this._fragment))return d.callback(this._fragment,e),!0;
return!1}},{key:"navigate",value:function(a,e,b){if(!c._started)return!1;b=void 0===b?{trigger:!0}:b;a=this.getFragment(a||"");var d=this._root+a;a=a.replace(A,"");if(this._fragment===a)return!1;this._fragment=a;""===a&&"/"!==d&&(d=d.slice(0,-1));if(this._hasPushState)this._history[b.replace?"replaceState":"pushState"]({},q.title,d);else if(this._wantsHashChange)this._updateHash(a,b.replace);else return this._location.assign(d);return b.trigger?this._loadUrl(a,e):!1}},{key:"on",value:function(a,e){void 0===
this._evtHandlers[a]&&(this._evtHandlers[a]=[]);this._evtHandlers[a].push(e);return this}},{key:"off",value:function(a,e){if(this._evtHandlers[a])for(var b=this._evtHandlers[a],d=b.length,c=0;c<d;c++)if(b[c]===e){b.splice(c,1);0===b.length&&delete this._evtHandlers[a];break}return this}},{key:"_trigger",value:function(a){var e=this._evtHandlers[a];if(void 0===e)return!1;for(var b=Array.prototype.slice.call(arguments,1),d=0,c=e.length,g=[],f=void 0;d<c;d++)f=e[d].apply(this,b),g.push(f);for(;d<c;d++)if(!1===
g[d])return!1;return!0}},{key:"_updateHash",value:function(a,e){if(e){var b=this._location.href.replace(/(javascript:|#).*$/,"");this._location.replace(b+"#"+a)}else this._location.hash="#"+a}}]);return c}(),p=function(){function c(a){a=void 0===a?{}:a;k(this,c);this._evtHandlers={};this._opts=a;this._bindHandlers()}m(c,[{key:"addHandler",value:function(a){var e=c._routeToRegExp(a.route),b=this;c.history._addHandler(e,function(d,f){var g=c._extractParameters(e,d);f&&g.push(f);var h={"new":{fragment:d,
params:g}};b._oldCtrl&&(h.old={fragment:b._oldCtrl.fragment,params:b._oldCtrl.params});b._trigger("route",h);c.history._trigger("route",b,h);b._oldCtrl&&b._oldCtrl.off&&b._oldCtrl.off.apply(b._oldCtrl);a.on.apply(a,g);b._oldCtrl={off:a.off,fragment:d,params:g}});return this}},{key:"navigate",value:function(a,e,b){c.history.navigate(a,e,b);return this}},{key:"_bindHandlers",value:function(){if(this._opts.map)for(var a=this._opts.map,e=a.length-1;0<=e;e--)this.addHandler(a[e])}}],[{key:"_routeToRegExp",
value:function(a){a=a.replace(v,"\\$&").replace(s,"(?:$1)?").replace(t,function(a,b){return b?a:"([^/?]+)"}).replace(u,"([^?]*?)");return new RegExp("^"+a+"(?:\\?([\\s\\S]*))?$")}},{key:"_extractParameters",value:function(a,e){for(var b=a.exec(e).slice(1),d=b.length,c=[],g=0,h=void 0;g<d;g++)h=b[g],g===b.length-1?c.push(h||null):c.push(h?f.decodeURIComponent(h):null);return c}}]);return c}();p.prototype._trigger=n.prototype._trigger;p.prototype.on=n.prototype.on;p.prototype.off=n.prototype.off;p.history=
new n;l.History=n;l.Router=p});
