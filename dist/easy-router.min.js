(function(l,h){if("function"===typeof define&&define.amd)define(["exports"],h);else if("undefined"!==typeof exports)h(exports);else{var k={};h(k);l.easyRouter=k}})(this,function(l){var h=function(d,a){if(!(d instanceof a))throw new TypeError("Cannot call a class as a function");},k=function(){function d(a,b){for(var c=0;c<b.length;c++){var e=b[c];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(a,e.key,e)}}return function(a,b,c){b&&d(a.prototype,b);
c&&d(a,c);return a}}();Object.defineProperty(l,"__esModule",{value:!0});var g="undefined"===typeof global?window:global,q=g.document,f=g.location,m=g.history,s=/\((.*?)\)/g,t=/(\(\?)?:\w+/g,u=/\*\w+/g,v=/[\-{}\[\]+?.,\\\^$|#\s]/g,w=/#(.*)$/,x=/[^\/]$/,r=/^[#\/]|\s+$/g,y=/^\/+|\/+$/g,z=/\/$/,A=/#.*$/,n=function(){function d(){var a=void 0===arguments[0]?{}:arguments[0];h(this,d);this.evtHandlers={};a.routes&&(this.routes=a.routes);this._bindRoutes();this.initialize.apply(this,arguments)}k(d,[{key:"initialize",
value:function(){}},{key:"on",value:function(a,b){void 0===this.evtHandlers[a]&&(this.evtHandlers[a]=[]);this.evtHandlers[a].push(b);return this}},{key:"trigger",value:function(a){var b=this.evtHandlers[a];if(void 0===b)return!1;for(var c=Array.prototype.slice.call(arguments,1),e=0,d=b.length,f=[],g=void 0;e<d;e++)g=b[e].apply(this,c),f.push(g);for(;e<d;e++)if(!1===f[e])return!1;return!0}},{key:"route",value:function(a,b,c){"[object RegExp]"!==Object.prototype.toString.call(a)&&(a=d._routeToRegExp(a));
"[object Function]"===Object.prototype.toString.call(b)&&(c=b,b="");c||(c=this[b]);var e=this;d.history.route(a,function(f){f=d._extractParameters(a,f);e.execute(c,f);e.trigger.apply(e,["route:"+b].concat(f));e.trigger("route",b,f);d.history.trigger("route",e,b,f)});return this}},{key:"execute",value:function(a,b){a&&a.apply(this,b)}},{key:"navigate",value:function(a,b){d.history.navigate(a,b);return this}},{key:"_bindRoutes",value:function(){if(this.routes)for(var a=Object.keys(this.routes),b=a.length-
1,c=void 0;0<=b;b--)c=a[b],this.route(c,this.routes[c])}}],[{key:"_routeToRegExp",value:function(a){a=a.replace(v,"\\$&").replace(s,"(?:$1)?").replace(t,function(a,c){return c?a:"([^/?]+)"}).replace(u,"([^?]*?)");return new RegExp("^"+a+"(?:\\?([\\s\\S]*))?$")}},{key:"_extractParameters",value:function(a,b){var c=a.exec(b).slice(1);return c.map(function(a,b){return b===c.length-1?a||null:a?decodeURIComponent(a):null})}}]);return d}(),p=function(){function d(){h(this,d);this.started=!1;this.checkUrl=
this.checkUrl.bind(this);this.handlers=[];this.evtHandlers={}}k(d,[{key:"atRoot",value:function(){return f.pathname.replace(x,"$&/")===this.root}},{key:"getHash",value:function(){var a=f.href.match(w);return a?a[1]:""}},{key:"getFragment",value:function(a,b){if(void 0===a)if(this._hasPushState||!this._wantsHashChange||b){a=decodeURI(f.pathname+f.search);var c=this.root.replace(z,"");a.indexOf(c)||(a=a.slice(c.length))}else a=this.getHash();return a.replace(r,"")}},{key:"start",value:function(a){if(d.started)throw Error("EasyRouter.history has already been started");
d.started=!0;this.options=a||{};this.options.root=a.root||"/";this.root=this.options.root;this._wantsHashChange=!1!==this.options.hashChange;this._wantsPushState=!!this.options.pushState;this._hasPushState=!!(this.options.pushState&&m&&m.pushState);this.fragment=this.getFragment();this.root=("/"+this.root+"/").replace(y,"/");this._hasPushState?g.addEventListener("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in g&&g.addEventListener("hashchange",this.checkUrl);if(this._wantsHashChange&&
this._wantsPushState){if(!this._hasPushState&&!this.atRoot())return this.fragment=this.getFragment(null,!0),f.replace(this.root+"#"+this.fragment),!0;this._hasPushState&&this.atRoot()&&f.hash&&(this.fragment=d.getHash().replace(r,""),m.replaceState({},q.title,this.root+this.fragment))}if(!this.options.silent)return this.loadUrl()}},{key:"stop",value:function(){g.removeEventListener("popstate",this.checkUrl);g.removeEventListener("hashchange",this.checkUrl);d.started=!1}},{key:"route",value:function(a,
b){this.handlers.unshift({route:a,callback:b})}},{key:"checkUrl",value:function(){if(this.getFragment()===this.fragment)return!1;this.loadUrl()}},{key:"loadUrl",value:function(a){this.fragment=this.getFragment(a);a=this.handlers.length;for(var b=void 0,c=0;c<a;c++)if(b=this.handlers[c],b.route.test(this.fragment))return b.callback(this.fragment),!0;return!1}},{key:"navigate",value:function(a,b){if(!d.started)return!1;b&&!0!==b||(b={trigger:!!b});var c=this.getFragment(a||""),c=c.replace(A,""),e=this.root+
c;if(this.fragment===c)return!1;this.fragment=c;""===c&&"/"!==e&&(e=e.slice(0,-1));if(this._hasPushState)m[b.replace?"replaceState":"pushState"]({},q.title,e);else if(this._wantsHashChange)d._updateHash(c,b.replace);else return f.assign(e);return b.trigger?this.loadUrl(c):!1}}],[{key:"_updateHash",value:function(a,b){if(b){var c=f.href.replace(/(javascript:|#).*$/,"");f.replace(c+"#"+a)}else f.hash="#"+a}}]);return d}();p.prototype.trigger=n.prototype.trigger;p.prototype.on=n.prototype.on;n.history=
new p;l.EasyRouter=n});
