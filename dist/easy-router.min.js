(function(h,g){if("function"===typeof define&&define.amd)define(["exports"],g);else if("undefined"!==typeof exports)g(exports);else{var l={};g(l);h.easyRouter=l}})(this,function(h){var g=function(d,a){if(!(d instanceof a))throw new TypeError("Cannot call a class as a function");},l=function(){function d(a,c){for(var b=0;b<c.length;b++){var e=c[b];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(a,e.key,e)}}return function(a,c,b){c&&d(a.prototype,c);
b&&d(a,b);return a}}();Object.defineProperty(h,"__esModule",{value:!0});var f="undefined"===typeof global?window:global,p=f.document,r=/\((.*?)\)/g,s=/(\(\?)?:\w+/g,t=/\*\w+/g,u=/[\-{}\[\]+?.,\\\^$|#\s]/g,v=/#(.*)$/,w=/[^\/]$/,q=/^[#\/]|\s+$/g,x=/^\/+|\/+$/g,y=/\/$/,z=/#.*$/,m=function(){function d(){g(this,d);this._started=!1;this._checkUrl=this._checkUrl.bind(this);this._handlers=[];this._evtHandlers={};this._location=f.location;this._history=f.history}l(d,[{key:"atRoot",value:function(){return this._location.pathname.replace(w,
"$&/")===this._root}},{key:"getHash",value:function(){var a=this._location.href.match(v);return a?a[1]:""}},{key:"getFragment",value:function(a,c){var b=a;if(void 0===b||null===b)if(this._hasPushState||!this._wantsHashChange||c){var b=f.decodeURI(this._location.pathname+this._location.search),e=this._root.replace(y,"");0===b.lastIndexOf(e,0)&&(b=b.slice(e.length))}else b=this.getHash();else b=f.decodeURI(b);return b.replace(q,"")}},{key:"start",value:function(a){a=void 0===a?{}:a;if(d._started)throw Error("Router.history has already been started");
d._started=!0;this._opts=a;this._opts.root=this._opts.root||"/";this._root=this._opts.root;this._wantsHashChange=!1!==this._opts.hashChange;this._wantsPushState=!!this._opts.pushState;this._hasPushState=!!(this._opts.pushState&&this._history&&this._history.pushState);a=this.getFragment();this._root=("/"+this._root+"/").replace(x,"/");this._hasPushState?f.addEventListener("popstate",this._checkUrl):this._wantsHashChange&&"onhashchange"in f&&f.addEventListener("hashchange",this._checkUrl);this._fragment=
a;if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot())return this._fragment=this.getFragment(null,!0),this._location.replace(this._root+"#"+this._fragment),!0;this._hasPushState&&this.atRoot()&&this._location.hash&&(this._fragment=this.getHash().replace(q,""),this._history.replaceState({},p.title,this._root+this._fragment))}return!0!==this._opts.silent?this._loadUrl():!1}},{key:"stop",value:function(){f.removeEventListener("popstate",this._checkUrl);f.removeEventListener("hashchange",
this._checkUrl);d._started=!1}},{key:"_addHandler",value:function(a,c){this._handlers.unshift({route:a,callback:c})}},{key:"_checkUrl",value:function(){if(this.getFragment()===this._fragment)return!1;this._loadUrl()}},{key:"_loadUrl",value:function(a,c){this._fragment=this.getFragment(a);for(var b=this._handlers.length,e=void 0,d=0;d<b;d++)if(e=this._handlers[d],e.route.test(this._fragment))return e.callback(this._fragment,c),!0;return!1}},{key:"navigate",value:function(a,c,b){b=void 0===b?{}:b;if(!d._started)return!1;
a=this.getFragment(a||"");var e=this._root+a;a=a.replace(z,"");if(this._fragment===a)return!1;this._fragment=a;""===a&&"/"!==e&&(e=e.slice(0,-1));if(this._hasPushState)this._history[b.replace?"replaceState":"pushState"]({},p.title,e);else if(this._wantsHashChange)this._updateHash(a,b.replace);else return this._location.assign(e);return!1!==b.trigger?this._loadUrl(a,c):!1}},{key:"on",value:function(a,c){void 0===this._evtHandlers[a]&&(this._evtHandlers[a]=[]);this._evtHandlers[a].push(c);return this}},
{key:"off",value:function(a,c){if(this._evtHandlers[a])for(var b=this._evtHandlers[a],e=b.length,d=0;d<e;d++)if(b[d]===c){b.splice(d,1);0===b.length&&delete this._evtHandlers[a];break}return this}},{key:"_trigger",value:function(a){var c=this._evtHandlers[a];if(void 0!==c)for(var b=Array.prototype.slice.call(arguments,1),e=0,d=c.length;e<d;e++)c[e].apply(this,b)}},{key:"_updateHash",value:function(a,c){if(c){var b=this._location.href.replace(/(javascript:|#).*$/,"");this._location.replace(b+"#"+a)}else this._location.hash=
"#"+a}}]);return d}(),n=function(){function d(a){a=void 0===a?{}:a;g(this,d);this._evtHandlers={};this._opts=a;this._bindHandlers()}l(d,[{key:"addHandler",value:function(a){var c=d._routeToRegExp(a.route),b=this;d.history._addHandler(c,function(e,f){var g=d._extractParameters(c,e),h=g.slice(0),k={};k["new"]={fragment:e,params:h,message:f};b._old&&(k.old={fragment:b._old.fragment,params:b._old.params});b._trigger("route:before",k);d.history._trigger("route:before",b,k);k.canceled||(g.push(k),b._old&&
b._old.handler.deactivate&&b._old.handler.deactivate.apply(b._old.handler),a.activate.apply(a,g),b._trigger("route:after",k),d.history._trigger("route:after",b,k),b._old={fragment:e,params:h,handler:a})});return this}},{key:"navigate",value:function(a,c,b){d.history.navigate(a,c,b);return this}},{key:"_bindHandlers",value:function(){if(this._opts.map)for(var a=this._opts.map,c=a.length-1;0<=c;c--)this.addHandler(a[c])}}],[{key:"_routeToRegExp",value:function(a){a=a.replace(u,"\\$&").replace(r,"(?:$1)?").replace(s,
function(a,b){return b?a:"([^/?]+)"}).replace(t,"([^?]*?)");return new RegExp("^"+a+"(?:\\?([\\s\\S]*))?$")}},{key:"_extractParameters",value:function(a,c){var b=a.exec(c).slice(1);return b.map(function(a,c){return c===b.length-1?a:void 0===a?void 0:decodeURIComponent(a)})}}]);return d}();n.prototype._trigger=m.prototype._trigger;n.prototype.on=m.prototype.on;n.prototype.off=m.prototype.off;n.history=new m;h.History=m;h.Router=n});
