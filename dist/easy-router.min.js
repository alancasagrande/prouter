(function(l,h){if("function"===typeof define&&define.amd)define(["exports"],h);else if("undefined"!==typeof exports)h(exports);else{var m={};h(m);l.easyRouter=m}})(this,function(l){var h=function(c,a){if(!(c instanceof a))throw new TypeError("Cannot call a class as a function");},m=function(){function c(a,d){for(var b=0;b<d.length;b++){var e=d[b];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(a,e.key,e)}}return function(a,d,b){d&&c(a.prototype,d);
b&&c(a,b);return a}}();Object.defineProperty(l,"__esModule",{value:!0});var f="undefined"===typeof global?window:global,q=f.document,s=/\((.*?)\)/g,t=/(\(\?)?:\w+/g,u=/\*\w+/g,v=/[\-{}\[\]+?.,\\\^$|#\s]/g,w=/#(.*)$/,x=/[^\/]$/,r=/^[#\/]|\s+$/g,y=/^\/+|\/+$/g,z=/\/$/,A=/#.*$/,n=function(){function c(){h(this,c);this._started=!1;this._checkUrl=this._checkUrl.bind(this);this._handlers=[];this._evtHandlers={};this._location=f.location;this._history=f.history}m(c,[{key:"atRoot",value:function(){return this._location.pathname.replace(x,
"$&/")===this._root}},{key:"getHash",value:function(){var a=this._location.href.match(w);return a?a[1]:""}},{key:"getFragment",value:function(a,d){var b=a;if(void 0===b||null===b)if(this._hasPushState||!this._wantsHashChange||d){var b=f.decodeURI(this._location.pathname+this._location.search),e=this._root.replace(z,"");0===b.lastIndexOf(e,0)&&(b=b.slice(e.length))}else b=this.getHash();else b=f.decodeURI(b);return b.replace(r,"")}},{key:"start",value:function(a){a=void 0===a?{}:a;if(c._started)throw Error("Router.history has already been started");
c._started=!0;this._opts=a;this._opts.root=this._opts.root||"/";this._root=this._opts.root;this._wantsHashChange=!1!==this._opts.hashChange;this._wantsPushState=!!this._opts.pushState;this._hasPushState=!!(this._opts.pushState&&this._history&&this._history.pushState);a=this.getFragment();this._root=("/"+this._root+"/").replace(y,"/");this._hasPushState?f.addEventListener("popstate",this._checkUrl):this._wantsHashChange&&"onhashchange"in f&&f.addEventListener("hashchange",this._checkUrl);this._fragment=
a;if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot())return this._fragment=this.getFragment(null,!0),this._location.replace(this._root+"#"+this._fragment),!0;this._hasPushState&&this.atRoot()&&this._location.hash&&(this._fragment=this.getHash().replace(r,""),this._history.replaceState({},q.title,this._root+this._fragment))}if(!this._opts.silent)return this._loadUrl()}},{key:"stop",value:function(){f.removeEventListener("popstate",this._checkUrl);f.removeEventListener("hashchange",
this._checkUrl);c._started=!1}},{key:"_addHandler",value:function(a,d){this._handlers.unshift({route:a,callback:d})}},{key:"_checkUrl",value:function(){if(this.getFragment()===this._fragment)return!1;this._loadUrl()}},{key:"_loadUrl",value:function(a,d){this._fragment=this.getFragment(a);for(var b=this._handlers.length,e=void 0,c=0;c<b;c++)if(e=this._handlers[c],e.route.test(this._fragment))return e.callback(this._fragment,d),!0;return!1}},{key:"navigate",value:function(a,d,b){if(!c._started)return!1;
b=void 0===b?{trigger:!0}:b;a=this.getFragment(a||"");var e=this._root+a;a=a.replace(A,"");if(this._fragment===a)return!1;this._fragment=a;""===a&&"/"!==e&&(e=e.slice(0,-1));if(this._hasPushState)this._history[b.replace?"replaceState":"pushState"]({},q.title,e);else if(this._wantsHashChange)this._updateHash(a,b.replace);else return this._location.assign(e);return b.trigger?this._loadUrl(a,d):!1}},{key:"on",value:function(a,d){void 0===this._evtHandlers[a]&&(this._evtHandlers[a]=[]);this._evtHandlers[a].push(d);
return this}},{key:"off",value:function(a,d){if(this._evtHandlers[a])for(var b=this._evtHandlers[a],e=b.length,c=0;c<e;c++)if(b[c]===d){b.splice(c,1);0===b.length&&delete this._evtHandlers[a];break}return this}},{key:"_trigger",value:function(a){var d=this._evtHandlers[a];if(void 0!==d)for(var b=Array.prototype.slice.call(arguments,1),e=0,c=d.length;e<c;e++)d[e].apply(this,b)}},{key:"_updateHash",value:function(a,d){if(d){var b=this._location.href.replace(/(javascript:|#).*$/,"");this._location.replace(b+
"#"+a)}else this._location.hash="#"+a}}]);return c}(),p=function(){function c(a){a=void 0===a?{}:a;h(this,c);this._evtHandlers={};this._opts=a;this._bindHandlers()}m(c,[{key:"addHandler",value:function(a){var d=c._routeToRegExp(a.route),b=this;c.history._addHandler(d,function(e,f){var k=c._extractParameters(d,e);f&&k.push(f);var g={"new":{fragment:e,params:k}};b._oldCtrl&&(g.old={fragment:b._oldCtrl.fragment,params:b._oldCtrl.params});b._trigger("route:before",g);c.history._trigger("route:before",
b,g);g.canceled||(b._oldCtrl&&b._oldCtrl.off&&b._oldCtrl.off.apply(b._oldCtrl),a.on.apply(a,k),b._trigger("route:after",g),c.history._trigger("route:after",b,g),b._oldCtrl={off:a.off,fragment:e,params:k})});return this}},{key:"navigate",value:function(a,d,b){c.history.navigate(a,d,b);return this}},{key:"_bindHandlers",value:function(){if(this._opts.map)for(var a=this._opts.map,d=a.length-1;0<=d;d--)this.addHandler(a[d])}}],[{key:"_routeToRegExp",value:function(a){a=a.replace(v,"\\$&").replace(s,"(?:$1)?").replace(t,
function(a,b){return b?a:"([^/?]+)"}).replace(u,"([^?]*?)");return new RegExp("^"+a+"(?:\\?([\\s\\S]*))?$")}},{key:"_extractParameters",value:function(a,d){for(var b=a.exec(d).slice(1),c=b.length,h=[],k=0,g=void 0;k<c;k++)g=b[k],k===b.length-1&&g?h.push(g||null):g&&h.push(f.decodeURIComponent(g));return h}}]);return c}();p.prototype._trigger=n.prototype._trigger;p.prototype.on=n.prototype.on;p.prototype.off=n.prototype.off;p.history=new n;l.History=n;l.Router=p});
