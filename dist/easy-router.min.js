(function(n,k){if("function"===typeof define&&define.amd)define(["exports"],k);else if("undefined"!==typeof exports)k(exports);else{var m={};k(m);n.easyRouter=m}})(this,function(n){var k=function(b,a){if(!(b instanceof a))throw new TypeError("Cannot call a class as a function");},m=function(){function b(a,c){for(var d=0;d<c.length;d++){var b=c[d];b.enumerable=b.enumerable||!1;b.configurable=!0;"value"in b&&(b.writable=!0);Object.defineProperty(a,b.key,b)}}return function(a,c,d){c&&b(a.prototype,c);
d&&b(a,d);return a}}();Object.defineProperty(n,"__esModule",{value:!0});var g="undefined"===typeof global?window:global,p=g.document,s=/\((.*?)\)/g,t=/(\(\?)?:\w+/g,u=/\*\w+/g,v=/[\-{}\[\]+?.,\\\^$|#\s]/g,w=/#(.*)$/,x=/[^\/]$/,q=/^[#\/]|\s+$/g,y=/^\/+|\/+$/g,z=/\/$/,A=/#.*$/,l=function(){function b(){k(this,b);this.started=!1;this.checkUrl=this.checkUrl.bind(this);this.handlers=[];this.evtHandlers={}}m(b,[{key:"atRoot",value:function(){return b.location.pathname.replace(x,"$&/")===this.root}},{key:"getFragment",
value:function(a,c){if(void 0===a)if(this._hasPushState||!this._wantsHashChange||c){a=decodeURI(b.location.pathname+b.location.search);var d=this.root.replace(z,"");a.indexOf(d)||(a=a.slice(d.length))}else a=b.getHash();return a.replace(q,"")}},{key:"start",value:function(a){if(b.started)throw Error("EasyRouter.history has already been started");b.started=!0;this.opts=a||{};this.opts.root=a.root||"/";this.root=this.opts.root;this._wantsHashChange=!1!==this.opts.hashChange;this._wantsPushState=!!this.opts.pushState;
this._hasPushState=!!(this.opts.pushState&&b.history&&b.history.pushState);this.fragment=this.getFragment();this.root=("/"+this.root+"/").replace(y,"/");this._hasPushState?g.addEventListener("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in g&&g.addEventListener("hashchange",this.checkUrl);if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot())return this.fragment=this.getFragment(null,!0),b.location.replace(this.root+"#"+this.fragment),!0;this._hasPushState&&
this.atRoot()&&b.location.hash&&(this.fragment=b.getHash().replace(q,""),b.history.replaceState({},p.title,this.root+this.fragment))}if(!this.opts.silent)return this.loadUrl()}},{key:"stop",value:function(){g.removeEventListener("popstate",this.checkUrl);g.removeEventListener("hashchange",this.checkUrl);b.started=!1}},{key:"route",value:function(a,c){this.handlers.unshift({route:a,callback:c})}},{key:"checkUrl",value:function(){if(this.getFragment()===this.fragment)return!1;this.loadUrl()}},{key:"loadUrl",
value:function(a){this.fragment=this.getFragment(a);a=this.handlers.length;for(var c=void 0,d=0;d<a;d++)if(c=this.handlers[d],c.route.test(this.fragment))return c.callback(this.fragment),!0;return!1}},{key:"navigate",value:function(a,c){if(!b.started)return!1;c&&!0!==c||(c={trigger:!!c});var d=this.getFragment(a||""),d=d.replace(A,""),e=this.root+d;if(this.fragment===d)return!1;this.fragment=d;""===d&&"/"!==e&&(e=e.slice(0,-1));if(this._hasPushState)history[c.replace?"replaceState":"pushState"]({},
p.title,e);else if(this._wantsHashChange)b._updateHash(d,c.replace);else return b.location.assign(e);return c.trigger?this.loadUrl(d):!1}},{key:"on",value:function(a,c){void 0===this.evtHandlers[a]&&(this.evtHandlers[a]=[]);this.evtHandlers[a].push(c);return this}},{key:"off",value:function(a,c){if(this.evtHandlers[a])for(var d=this.evtHandlers[a],b=d.length,f=0;f<b;f++)if(d[f]===c){d.splice(f,1);0===d.length&&delete this.evtHandlers[a];break}return this}},{key:"trigger",value:function(a){var c=this.evtHandlers[a];
if(void 0===c)return!1;for(var b=Array.prototype.slice.call(arguments,1),e=0,f=c.length,r=[],g=void 0;e<f;e++)g=c[e].apply(this,b),r.push(g);for(;e<f;e++)if(!1===r[e])return!1;return!0}}],[{key:"getHash",value:function(){var a=b.location.href.match(w);return a?a[1]:""}},{key:"_updateHash",value:function(a,c){if(c){var d=b.location.href.replace(/(javascript:|#).*$/,"");b.location.replace(d+"#"+a)}else b.location.hash="#"+a}}]);return b}();l.location=g.location;l.history=g.history;var h=function(){function b(){var a=
void 0===arguments[0]?{}:arguments[0];k(this,b);this.evtHandlers={};this.opts=a;this._bindRoutes();this.opts.initialize&&this.opts.initialize.apply(this,arguments)}m(b,[{key:"route",value:function(a,c,d){var e="[object RegExp]"===Object.prototype.toString.call(a)?a:b._routeToRegExp(a);"[object Function]"===Object.prototype.toString.call(c)&&(d=c,c="");d||(d=this.opts[c],"implicit"===a&&"implicit"===c&&console.log("onCallback",c,d));var f=this;b.history.route(e,function(a){a=b._extractParameters(e,
a);f.execute(d,a);f.trigger.apply(f,["route:"+c].concat(a));f.trigger("route",c,a);b.history.trigger("route",f,c,a)});return this}},{key:"execute",value:function(a,c){a&&a.apply(this,c)}},{key:"navigate",value:function(a,c){b.history.navigate(a,c);return this}},{key:"_bindRoutes",value:function(){if(this.opts.routes)for(var a=Object.keys(this.opts.routes),c=a.length-1,b=void 0;0<=c;c--)b=a[c],this.route(b,this.opts.routes[b])}}],[{key:"_routeToRegExp",value:function(a){a=a.replace(v,"\\$&").replace(s,
"(?:$1)?").replace(t,function(a,b){return b?a:"([^/?]+)"}).replace(u,"([^?]*?)");return new RegExp("^"+a+"(?:\\?([\\s\\S]*))?$")}},{key:"_extractParameters",value:function(a,b){var d=a.exec(b).slice(1);return d.map(function(a,b){return b===d.length-1?a||null:a?decodeURIComponent(a):null})}}]);return b}();h.History=l;h.prototype.trigger=l.prototype.trigger;h.prototype.on=l.prototype.on;h.prototype.off=l.prototype.off;h.history=new h.History;n.EasyRouter=h});
