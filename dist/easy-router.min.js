(function(l,h){if("function"===typeof define&&define.amd)define(["exports"],h);else if("undefined"!==typeof exports)h(exports);else{var k={};h(k);l.easyRouter=k}})(this,function(l){var h=function(e,a){if(!(e instanceof a))throw new TypeError("Cannot call a class as a function");},k=function(){function e(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(a,b,c){b&&e(a.prototype,b);
c&&e(a,c);return a}}();Object.defineProperty(l,"__esModule",{value:!0});var s=/\((.*?)\)/g,t=/(\(\?)?:\w+/g,u=/\*\w+/g,v=/[\-{}\[\]+?.,\\\^$|#\s]/g,f="undefined"===typeof f?window:f,w=f.document,g=f.location,m=f.history,n=function(){function e(){var a=void 0===arguments[0]?{}:arguments[0];h(this,e);this.evtHandlers={};a.routes&&(this.routes=a.routes);this._bindRoutes();this.initialize.apply(this,arguments)}k(e,[{key:"initialize",value:function(){}},{key:"on",value:function(a,b){void 0===this.evtHandlers[a]&&
(this.evtHandlers[a]=[]);this.evtHandlers[a].push(b);return this}},{key:"trigger",value:function(a){var b=this.evtHandlers[a];if(void 0===b)return!1;for(var c=Array.prototype.slice.call(arguments,1),d=0,e=b.length,q=[],f=void 0;d<e;d++)f=b[d].apply(this,c),q.push(f);for(;d<e;d++)if(!1===q[d])return!1;return!0}},{key:"route",value:function(a){function b(b,d,e){return a.apply(this,arguments)}b.toString=function(){return a.toString()};return b}(function(a,b,c){var d="[object RegExp]"===Object.prototype.toString.call(a)?
a:e._routeToRegExp(a);"[object Function]"===Object.prototype.toString.call(b)&&(c=b,b="");c||(c=this[b]);var f=this;e.history.route(d,function(a){a=e._extractParameters(d,a);f.execute(c,a);f.trigger.apply(f,["route:"+b].concat(a));f.trigger("route",b,a);e.history.trigger("route",f,b,a)});return this})},{key:"execute",value:function(a,b){a&&a.apply(this,b)}},{key:"navigate",value:function(a,b){e.history.navigate(a,b);return this}},{key:"_bindRoutes",value:function(){if(this.routes){var a=Object.keys(this.routes).reverse(),
b=!0,c=!1,d=void 0;try{for(var e=a[Symbol.iterator](),f;!(b=(f=e.next()).done);b=!0){var g=f.value;this.route(g,this.routes[g])}}catch(h){c=!0,d=h}finally{try{if(!b&&e["return"])e["return"]()}finally{if(c)throw d;}}}}}],[{key:"_routeToRegExp",value:function(a){a=a.replace(v,"\\$&").replace(s,"(?:$1)?").replace(t,function(a,c){return c?a:"([^/?]+)"}).replace(u,"([^?]*?)");return new RegExp("^"+a+"(?:\\?([\\s\\S]*))?$")}},{key:"_extractParameters",value:function(a,b){var c=a.exec(b).slice(1);return c.map(function(a,
b){return b===c.length-1?a||null:a?decodeURIComponent(a):null})}}]);return e}(),r=/^[#\/]|\s+$/g,x=/^\/+|\/+$/g,y=/\/$/,z=/#.*$/,p=function(){function e(){h(this,e);this.started=!1;this.checkUrl=this.checkUrl.bind(this);this.handlers=[];this.evtHandlers={}}k(e,[{key:"atRoot",value:function(){return g.pathname.replace(/[^\/]$/,"$&/")===this.root}},{key:"getHash",value:function(){var a=g.href.match(/#(.*)$/);return a?a[1]:""}},{key:"getFragment",value:function(a,b){if(void 0===a)if(this._hasPushState||
!this._wantsHashChange||b){a=decodeURI(g.pathname+g.search);var c=this.root.replace(y,"");a.indexOf(c)||(a=a.slice(c.length))}else a=this.getHash();return a.replace(r,"")}},{key:"start",value:function(a){if(e.started)throw Error("EasyRouter.history has already been started");e.started=!0;this.options=a||{};this.options.root=a.root||"/";this.root=this.options.root;this._wantsHashChange=!1!==this.options.hashChange;this._wantsPushState=!!this.options.pushState;this._hasPushState=!!(this.options.pushState&&
m&&m.pushState);this.fragment=this.getFragment();this.root=("/"+this.root+"/").replace(x,"/");this._hasPushState?f.addEventListener("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in f&&f.addEventListener("hashchange",this.checkUrl);if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot())return this.fragment=this.getFragment(null,!0),g.replace(this.root+"#"+this.fragment),!0;this._hasPushState&&this.atRoot()&&g&&(this.fragment=e.getHash().replace(r,""),
m.replaceState({},f.document.title,this.root+this.fragment))}if(!this.options.silent)return this.loadUrl()}},{key:"stop",value:function(){f.removeEventListener("popstate",this.checkUrl);f.removeEventListener("hashchange",this.checkUrl);e.started=!1}},{key:"route",value:function(a){function b(b,d){return a.apply(this,arguments)}b.toString=function(){return a.toString()};return b}(function(a,b){this.handlers.unshift({route:a,callback:b})})},{key:"checkUrl",value:function(){if(this.getFragment()===this.fragment)return!1;
this.loadUrl()}},{key:"loadUrl",value:function(a){a=this.fragment=this.getFragment(a);for(var b=this.handlers.length,c=void 0,d=0;d<b;d++)if(c=this.handlers[d],c.route.test(a))return c.callback(a),!0;return!1}},{key:"navigate",value:function(a,b){if(!e.started)return!1;b&&!0!==b||(b={trigger:!!b});var c=this.getFragment(a||""),c=c.replace(z,""),d=this.root+c;if(this.fragment===c)return!1;this.fragment=c;""===c&&"/"!==d&&(d=d.slice(0,-1));if(this._hasPushState)m[b.replace?"replaceState":"pushState"]({},
w.title,d);else if(this._wantsHashChange)e._updateHash(c,b.replace);else return g.assign(d);return b.trigger?this.loadUrl(c):!1}}],[{key:"_updateHash",value:function(a,b){if(b){var c=g.href.replace(/(javascript:|#).*$/,"");g.replace(c+"#"+a)}else g.hash="#"+a}}]);return e}();p.prototype.trigger=n.prototype.trigger;p.prototype.on=n.prototype.on;n.history=new p;l.EasyRouter=n});
