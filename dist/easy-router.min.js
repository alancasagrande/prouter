!function(t,e){if("function"==typeof define&&define.amd)define(["exports"],e);else if("undefined"!=typeof exports)e(exports);else{var r={exports:{}};e(r.exports),t.easyRouter=r.exports}}(this,function(t){"use strict";var e=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},r=function(){function t(t,e){for(var r=0;r<e.length;r++){var a=e[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(e,r,a){return r&&t(e.prototype,r),a&&t(e,a),e}}();Object.defineProperty(t,"__esModule",{value:!0});var a="undefined"==typeof global?window:global,s=a.document,i=/\((.*?)\)/g,n=/(\(\?)?:\w+/g,o=/\*\w+/g,h=/[\-{}\[\]+?.,\\\^$|#\s]/g,l=/#(.*)$/,u=/[^\/]$/,_=/^[#\/]|\s+$/g,c=/^\/+|\/+$/g,f=/\/$/,d=/#.*$/,p=function(){function t(){e(this,t),this._started=!1,this._checkUrl=this._checkUrl.bind(this),this._handlers=[],this._evtHandlers={},this._location=a.location,this._history=a.history}return r(t,[{key:"atRoot",value:function(){return this._location.pathname.replace(u,"$&/")===this._root}},{key:"getHash",value:function(){var t=this._location.href.match(l);return t?t[1]:""}},{key:"getFragment",value:function(t,e){var r=t;if(void 0===r||null===r)if(this._hasPushState||!this._wantsHashChange||e){r=a.decodeURI(this._location.pathname+this._location.search);var s=this._root.replace(f,"");0===r.lastIndexOf(s,0)&&(r=r.slice(s.length))}else r=this.getHash();else r=a.decodeURI(r);return r.replace(_,"")}},{key:"start",value:function(){var e=void 0===arguments[0]?{}:arguments[0];if(t._started)throw new Error("Router.history has already been started");t._started=!0,this._opts=e,this._opts.root=this._opts.root||"/",this._root=this._opts.root,this._wantsHashChange=this._opts.hashChange!==!1,this._wantsPushState=!!this._opts.pushState,this._hasPushState=!!(this._opts.pushState&&this._history&&this._history.pushState);var r=this.getFragment();if(this._root=("/"+this._root+"/").replace(c,"/"),this._hasPushState?a.addEventListener("popstate",this._checkUrl):this._wantsHashChange&&"onhashchange"in a&&a.addEventListener("hashchange",this._checkUrl),this._fragment=r,this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot())return this._fragment=this.getFragment(null,!0),this._location.replace(this._root+"#"+this._fragment),!0;this._hasPushState&&this.atRoot()&&this._location.hash&&(this._fragment=this.getHash().replace(_,""),this._history.replaceState({},s.title,this._root+this._fragment))}return this._opts.silent!==!0?this._loadUrl():!1}},{key:"stop",value:function(){a.removeEventListener("popstate",this._checkUrl),a.removeEventListener("hashchange",this._checkUrl),t._started=!1}},{key:"_addHandler",value:function(t,e){this._handlers.unshift({route:t,callback:e})}},{key:"_checkUrl",value:function(){var t=this.getFragment();return t===this._fragment?!1:void this._loadUrl()}},{key:"_loadUrl",value:function(t,e){this._fragment=this.getFragment(t);for(var r=this._handlers.length,a=void 0,s=0;r>s;s++)if(a=this._handlers[s],a.route.test(this._fragment))return a.callback(this._fragment,e),!0;return!1}},{key:"navigate",value:function(e,r){var a=void 0===arguments[2]?{}:arguments[2];if(!t._started)return!1;var i=this.getFragment(e||""),n=this._root+i;if(i=i.replace(d,""),this._fragment===i)return!1;if(this._fragment=i,""===i&&"/"!==n&&(n=n.slice(0,-1)),this._hasPushState)this._history[a.replace?"replaceState":"pushState"]({},s.title,n);else{if(!this._wantsHashChange)return this._location.assign(n);this._updateHash(i,a.replace)}return a.trigger!==!1?this._loadUrl(i,r):!1}},{key:"on",value:function(t,e){return void 0===this._evtHandlers[t]&&(this._evtHandlers[t]=[]),this._evtHandlers[t].push(e),this}},{key:"off",value:function(t,e){if(this._evtHandlers[t])for(var r=this._evtHandlers[t],a=r.length,s=0;a>s;s++)if(r[s]===e){r.splice(s,1),0===r.length&&delete this._evtHandlers[t];break}return this}},{key:"_trigger",value:function(t){var e=this._evtHandlers[t];if(void 0!==e)for(var r=Array.prototype.slice.call(arguments,1),a=0,s=e.length;s>a;a++)e[a].apply(this,r)}},{key:"_updateHash",value:function(t,e){if(e){var r=this._location.href.replace(/(javascript:|#).*$/,"");this._location.replace(r+"#"+t)}else this._location.hash="#"+t}}]),t}(),g=function(){function t(){var r=void 0===arguments[0]?{}:arguments[0];e(this,t),this._evtHandlers={},this._opts=r,this._bindHandlers()}return r(t,[{key:"addHandler",value:function(e){var r=t._routeToRegExp(e.route),a=this;return t.history._addHandler(r,function(s,i){var n=t._extractParameters(r,s),o=n.slice(0),h={};h["new"]={fragment:s,params:o,message:i},a._old&&(h.old={fragment:a._old.fragment,params:a._old.params}),a._trigger("route:before",h),t.history._trigger("route:before",a,h),h.canceled||(n.push(h),a._old&&a._old.handler.deactivate&&a._old.handler.deactivate.apply(a._old.handler),e.activate.apply(e,n),a._trigger("route:after",h),t.history._trigger("route:after",a,h),a._old={fragment:s,params:o,handler:e})}),this}},{key:"navigate",value:function(e,r,a){return t.history.navigate(e,r,a),this}},{key:"_bindHandlers",value:function(){if(this._opts.map)for(var t=this._opts.map,e=t.length-1,r=e;r>=0;r--)this.addHandler(t[r])}}],[{key:"_routeToRegExp",value:function(t){var e=t.replace(h,"\\$&").replace(i,"(?:$1)?").replace(n,function(t,e){return e?t:"([^/?]+)"}).replace(o,"([^?]*?)");return new RegExp("^"+e+"(?:\\?([\\s\\S]*))?$")}},{key:"_extractParameters",value:function(t,e){var r=t.exec(e).slice(1);return r.map(function(t,e){return e===r.length-1?t:void 0===t?void 0:decodeURIComponent(t)})}}]),t}();g.prototype._trigger=p.prototype._trigger,g.prototype.on=p.prototype.on,g.prototype.off=p.prototype.off,g.history=new p,t.History=p,t.Router=g});